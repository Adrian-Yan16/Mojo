## MojoğŸ”¥ç¼–ç¨‹æ‰‹å†Œ

ä¸€ä¸ªå…¨é¢çš„ Mojo è¯­è¨€ç‰¹æ€§åŠå…¶ä»£ç ç¤ºä¾‹ä¹‹æ—…ã€‚


Mojoæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œå®ƒåƒPythonä¸€æ ·æ˜“äºä½¿ç”¨ï¼Œä½†å…·æœ‰C++å’ŒRustçš„æ€§èƒ½ã€‚æ­¤å¤–ï¼ŒMojoè¿˜æä¾›äº†åˆ©ç”¨æ•´ä¸ªPythonåº“ç”Ÿæ€ç³»ç»Ÿçš„èƒ½åŠ›ã€‚


Mojoé€šè¿‡åˆ©ç”¨é›†æˆç¼“å­˜ã€å¤šçº¿ç¨‹å’Œäº‘åˆ†å¸ƒæŠ€æœ¯çš„ä¸‹ä¸€ä»£ç¼–è¯‘å™¨æŠ€æœ¯æ¥å®ç°è¿™ä¸€å£®ä¸¾ã€‚æ­¤å¤–ï¼ŒMojoçš„è‡ªåŠ¨è°ƒæ•´å’Œç¼–è¯‘æ—¶å…ƒç¼–ç¨‹åŠŸèƒ½å¯ä»¥è®©æ‚¨ç¼–å†™å¯ç§»æ¤åˆ°æœ€å¥‡ç‰¹ç¡¬ä»¶çš„ä»£ç ã€‚


æ›´é‡è¦çš„æ˜¯ï¼ŒMojoè®©ä½ å¯ä»¥åˆ©ç”¨æ•´ä¸ªPythonç”Ÿæ€ç³»ç»Ÿï¼Œè¿™æ ·ä½ å°±å¯ä»¥ç»§ç»­ä½¿ç”¨ä½ ç†Ÿæ‚‰çš„å·¥å…·ã€‚Mojoæ—¨åœ¨é€šè¿‡ä¿ç•™Pythonçš„åŠ¨æ€ç‰¹æ€§ï¼ŒåŒæ—¶æ·»åŠ æ–°çš„[ç³»ç»Ÿç¼–ç¨‹](https://en.wikipedia.org/wiki/Systems_programming)å’Œ[å¹¶å‘.è¿™äº›æ–°çš„ç³»ç»Ÿç¼–ç¨‹åŸè¯­å°†å…è®¸Mojoå¼€å‘äººå‘˜æ„å»ºå½“å‰éœ€è¦Cã€C++ã€Rustã€CUDAå’Œå…¶ä»–åŠ é€Ÿå™¨ç³»ç»Ÿçš„é«˜æ€§èƒ½åº“ã€‚é€šè¿‡å°†åŠ¨æ€è¯­è¨€å’Œç³»ç»Ÿè¯­è¨€çš„ä¼˜ç‚¹ç»“åˆèµ·æ¥ï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›ä¸€ç§**ç»Ÿä¸€**çš„ç¼–ç¨‹æ¨¡å‹ï¼Œå®ƒèƒ½å¤Ÿé€‚ç”¨äºä¸åŒçš„æŠ½è±¡å±‚æ¬¡ï¼Œå¯¹åˆå­¦è€…å‹å¥½ï¼Œå¹¶å¯ä»¥åœ¨å¤šç§ç”¨ä¾‹ä¸­è¿›è¡Œæ‰©å±•ï¼ŒåŒ…æ‹¬åŠ é€Ÿå™¨ã€åº”ç”¨ç¨‹åºç¼–ç¨‹å’Œè„šæœ¬ç¼–å†™ã€‚


è¿™ä»½æ–‡æ¡£æ˜¯å¯¹Mojoç¼–ç¨‹è¯­è¨€çš„ä»‹ç»ï¼Œè€Œä¸æ˜¯ä¸€ä»½å®Œæ•´çš„è¯­è¨€æŒ‡å—ã€‚å®ƒå‡å®šäº†å¯¹Pythonå’Œç³»ç»Ÿç¼–ç¨‹æ¦‚å¿µçš„äº†è§£ã€‚ç›®å‰ï¼ŒMojoä»å¤„äºå¼€å‘é˜¶æ®µï¼Œæ–‡æ¡£é¢å‘å…·æœ‰ç³»ç»Ÿç¼–ç¨‹ç»éªŒçš„å¼€å‘äººå‘˜ã€‚éšç€è¯­è¨€çš„å‘å±•å’Œæ›´å¹¿æ³›çš„å¯ç”¨æ€§ï¼Œæˆ‘ä»¬å¸Œæœ›å®ƒå¯¹æ¯ä¸ªäººï¼ŒåŒ…æ‹¬åˆå­¦è€…ç¨‹åºå‘˜ï¼Œéƒ½å‹å¥½å’Œæ˜“äºè®¿é—®ã€‚ä»Šå¤©å®ƒå°±æ˜¯ä¸åœ¨é‚£é‡Œã€‚

## ä½¿ç”¨Mojoç¼–è¯‘å™¨


ä½ å¯ä»¥åƒè¿è¡ŒPythonç¨‹åºä¸€æ ·ï¼Œä»ç»ˆç«¯è¿è¡ŒMojoç¨‹åºã€‚å¦‚æœä½ æœ‰ä¸€ä¸ªå«åš`hello.mojo`ï¼ˆæˆ–è€…`hello.ğŸ”¥`â€”â€”æ˜¯çš„ï¼Œæ–‡ä»¶æ‰©å±•åå¯ä»¥æ˜¯è¡¨æƒ…ç¬¦å·ï¼ï¼‰çš„æ–‡ä»¶ï¼Œåªéœ€è¦è¾“å…¥`mojo hello.mojo`:

```auto
$ cat hello.ğŸ”¥
def main():
    print("hello world")
    for x in range(9, 0, -3):
        print(x)
$ mojo hello.ğŸ”¥
hello world
9
6
3
$
```

å†æ¬¡ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨è¡¨æƒ…ç¬¦å·æˆ– `.mojo` åç¼€ã€‚

å¦‚æœä½ æœ‰å…´è¶£æ·±å…¥äº†è§£Mojoçš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼Œå¯ä»¥å‚è€ƒæ ‡å‡†åº“ä¸­çš„ç±»å‹ã€ç¬”è®°æœ¬ã€åšå®¢å’Œå…¶ä»–ç¤ºä¾‹ä»£ç 

## åŸºæœ¬ç³»ç»Ÿç¼–ç¨‹æ‰©å±•


é‰´äºæˆ‘ä»¬çš„å…¼å®¹æ€§ç›®æ ‡å’ŒPythonåœ¨é«˜çº§åº”ç”¨å’ŒåŠ¨æ€APIæ–¹é¢çš„ä¼˜åŠ¿ï¼Œæˆ‘ä»¬ä¸å¿…èŠ±å¤ªå¤šæ—¶é—´æ¥è§£é‡Šè¯­è¨€çš„è¿™äº›éƒ¨åˆ†ã€‚å¦ä¸€æ–¹é¢ï¼ŒPythonå¯¹ç³»ç»Ÿç¼–ç¨‹çš„æ”¯æŒä¸»è¦å§”æ‰˜ç»™Cï¼Œæˆ‘ä»¬å¸Œæœ›æä¾›ä¸€ä¸ªåœ¨è¿™ä¸ªä¸–ç•Œä¸­ä¹Ÿå¾ˆæ£’çš„å•ä¸€ç³»ç»Ÿã€‚å› æ­¤ï¼Œæœ¬èŠ‚å°†å¯¹æ¯ä¸ªä¸»è¦ç»„ä»¶å’ŒåŠŸèƒ½è¿›è¡Œè¯¦ç»†åˆ†è§£ï¼Œå¹¶é€šè¿‡ç¤ºä¾‹è¯´æ˜å¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚

## `let` å’Œ `var` å£°æ˜


åœ¨Mojoä¸­çš„`def`å†…éƒ¨ï¼Œä½ å¯ä»¥ç»™ä¸€ä¸ªåå­—èµ‹å€¼ï¼Œå®ƒä¼šéšå¼åœ°åˆ›å»ºä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸå˜é‡ï¼Œå°±åƒåœ¨Pythonä¸­ä¸€æ ·ã€‚è¿™æä¾›äº†ä¸€ç§éå¸¸åŠ¨æ€ä¸”ä½ä»ªå¼çš„ç¼–å†™ä»£ç æ–¹å¼ï¼Œä½†å®ƒä¹Ÿå­˜åœ¨ä¸¤ä¸ªæŒ‘æˆ˜ï¼š

1. ç³»ç»Ÿç¨‹åºå‘˜ç»å¸¸å¸Œæœ›å£°æ˜ä¸€ä¸ªå€¼æ˜¯ä¸å¯å˜çš„ï¼Œä»¥ä¿è¯ç±»å‹å®‰å…¨å’Œæ€§èƒ½ã€‚
1. å¦‚æœä»–ä»¬åœ¨èµ‹å€¼è¿‡ç¨‹ä¸­é”™è¯¯åœ°è¾“å…¥å˜é‡åï¼Œä»–ä»¬å¯èƒ½ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯ã€‚


ä¸ºäº†æ”¯æŒè¿™ä¸€ç‚¹ï¼ŒMojo æä¾›äº†ä½œç”¨åŸŸè¿è¡Œæ—¶å€¼å£°æ˜ï¼š`let` æ˜¯ä¸å¯å˜çš„ï¼Œè€Œ `var` æ˜¯å¯å˜çš„ã€‚è¿™äº›å€¼ä½¿ç”¨è¯æ³•ä½œç”¨åŸŸå¹¶æ”¯æŒåç§°é˜´å½±ã€‚

```auto
def your_function(a, b):
    let c = a
    c = b  # error: c is immutable

    if c != b:
        var c = b
        stuff()
```

`let`å’Œ`var`å£°æ˜æ”¯æŒç±»å‹è¯´æ˜ç¬¦ä»¥åŠæ¨¡å¼ï¼Œä»¥åŠåæœŸåˆå§‹åŒ–ã€‚

```auto
def your_function():
    let x: SI8 = 42
    let y: SI64 = 17

    let z: SI8
    if x != 0:
        z = 1
    else:
        z = foo()
    use(z)
```


æ³¨æ„ï¼Œåœ¨`def`å£°æ˜ä¸­ï¼Œ`let`å’Œ`var`å®Œå…¨æ˜¯å¯é€‰çš„ã€‚æ‚¨ä»ç„¶å¯ä»¥åƒä½¿ç”¨Pythonä¸€æ ·ä½¿ç”¨éšå¼å£°æ˜çš„å€¼ï¼Œå®ƒä»¬ä¼šæŒ‰ç…§æƒ¯ä¾‹å…·æœ‰å‡½æ•°ä½œç”¨åŸŸã€‚

## `struct`ç±»å‹


MojoåŸºäºMLIRå’ŒLLVMï¼Œå®ƒä»¬æä¾›äº†ä¸€ä¸ªå°–ç«¯çš„ç¼–è¯‘å™¨å’Œä»£ç ç”Ÿæˆç³»ç»Ÿï¼Œè¢«ç”¨äºè®¸å¤šç¼–ç¨‹è¯­è¨€ã€‚è¿™è®©æˆ‘ä»¬æ›´å¥½åœ°æ§åˆ¶æ•°æ®ç»„ç»‡ï¼Œç›´æ¥è®¿é—®æ•°æ®å­—æ®µä»¥åŠå…¶ä»–æ”¹å–„æ€§èƒ½çš„æ–¹å¼ã€‚ç°ä»£ç³»ç»Ÿç¼–ç¨‹è¯­è¨€çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§æ˜¯ï¼Œå¯ä»¥åœ¨å¤æ‚çš„ä½çº§æ“ä½œä¹‹ä¸Šæ„å»ºé«˜çº§å’Œå®‰å…¨çš„æŠ½è±¡ï¼Œè€Œä¸ä¼šå¯¼è‡´åœ¨Mojoä¸­ï¼Œè¿™ç”±`struct`ç±»å‹æä¾›ã€‚


Mojoä¸­çš„`struct`ç±»ä¼¼äºPythonçš„`class`ï¼šå®ƒä»¬éƒ½æ”¯æŒæ–¹æ³•ã€å­—æ®µã€è¿ç®—ç¬¦é‡è½½ã€ç”¨äºå…ƒç¼–ç¨‹çš„è£…é¥°å™¨ç­‰ã€‚ä»–ä»¬çš„å·®å¼‚å¦‚ä¸‹ï¼š

+ Pythonç±»æ˜¯åŠ¨æ€çš„ï¼šå®ƒä»¬å…è®¸åŠ¨æ€åˆ†æ´¾ã€çŒ´å­è¡¥ä¸ï¼ˆæˆ–â€œæ··æ·†â€ï¼‰ä»¥åŠåœ¨è¿è¡Œæ—¶åŠ¨æ€ç»‘å®šå®ä¾‹å±æ€§ã€‚

+ Mojoç»“æ„æ˜¯é™æ€çš„ï¼šå®ƒä»¬åœ¨ç¼–è¯‘æ—¶ç»‘å®šï¼ˆæ‚¨ä¸èƒ½åœ¨è¿è¡Œæ—¶æ·»åŠ æ–¹æ³•ï¼‰ç»“æ„å…è®¸æ‚¨åœ¨å®‰å…¨ä¸”æ˜“äºä½¿ç”¨çš„åŒæ—¶ï¼Œä»¥çµæ´»æ€§æ¢å–æ€§èƒ½ã€‚


è¿™æ˜¯ä¸€ä¸ªç»“æ„çš„ç®€å•å®šä¹‰ï¼š

```auto
@value
struct MyPair:
    var first: Int
    var second: Int
    def __lt__(self, rhs: MyPair) -> Bool:
        return self.first < rhs.first or
              (self.first == rhs.first and
               self.second < rhs.second)
```

è¯­æ³•ä¸Šï¼Œä¸Python `class`ç›¸æ¯”ï¼Œ`struct`ä¸­æ‰€æœ‰å®ä¾‹å±æ€§**å¿…é¡»**ä½¿ç”¨`var`æˆ–`let`å£°æ˜æ˜ç¡®å£°æ˜ã€‚


åœ¨Mojoä¸­ï¼Œâ€œstructâ€çš„ç»“æ„å’Œå†…å®¹æ˜¯é¢„å…ˆè®¾å®šçš„ï¼Œåœ¨ç¨‹åºè¿è¡ŒæœŸé—´ä¸èƒ½æ›´æ”¹ã€‚ä¸Pythonä¸åŒï¼ŒMojoä¸å…è®¸å¯¹ç»“æ„ä½“è¿›è¡Œå³æ—¶çš„å¢åŠ ã€åˆ é™¤æˆ–æ›´æ”¹å±æ€§ã€‚è¿™æ„å‘³ç€ä½ ä¸èƒ½ä½¿ç”¨`del`åœ¨ç¨‹åºè¿è¡Œä¸­ç§»é™¤ä¸€ä¸ªæ–¹æ³•æˆ–æ”¹å˜å®ƒçš„å€¼ã€‚

ç„¶è€Œï¼Œ`struct`çš„é™æ€ç‰¹æ€§æœ‰ä¸€äº›å¾ˆå¤§çš„å¥½å¤„ï¼å®ƒæœ‰åŠ©äºMojoæ›´å¿«ã€æ›´å¯é åœ°è¿è¡Œæ‚¨çš„ä»£ç ã€‚ç¨‹åºç²¾ç¡®åœ°çŸ¥é“åœ¨å“ªé‡Œæ‰¾åˆ°ç»“æ„ä¿¡æ¯ï¼Œä»¥åŠå¦‚ä½•åœ¨æ²¡æœ‰ä»»ä½•é¢å¤–æ­¥éª¤æˆ–å»¶è¿Ÿçš„æƒ…å†µä¸‹ä½¿ç”¨å®ƒã€‚

Mojoçš„ç»“æ„ä¹Ÿéå¸¸é€‚åˆæ‚¨å¯èƒ½å·²ç»ç†Ÿæ‚‰çš„Pythonç‰¹æ€§ï¼Œä¾‹å¦‚è¿ç®—ç¬¦é‡è½½ï¼ˆå¯ä»¥è®©æ‚¨æ›´æ”¹`+`å’Œ`-`ç­‰æ•°ã€‚æ­¤å¤–ï¼Œæ‰€æœ‰çš„â€œæ ‡å‡†ç±»å‹â€ï¼ˆå¦‚`Int`ã€`Bool`ã€`String`ç”šè‡³`Tuple`ï¼‰éƒ½æ˜¯ä½¿ç”¨ç»“æ„ä½“åˆ¶ä½œçš„ã€‚è¿™æ„å‘³ç€å®ƒä»¬æ˜¯æ ‡å‡†å·¥å…·é›†çš„ä¸€éƒ¨åˆ†ï¼Œè€Œä¸æ˜¯å†…ç½®äºè¯­è¨€æœ¬èº«ä¸­ã€‚è¿™ç»™ä½ åœ¨ç¼–å†™ä»£ç æ—¶æ›´å¤šçš„çµæ´»æ€§å’Œæ§åˆ¶æƒã€‚


å¦‚æœä½ æƒ³çŸ¥é“`inout`åœ¨`self`å‚æ•°ä¸Šæ„å‘³ç€ä»€ä¹ˆï¼šè¿™è¡¨æ˜è¯¥å‚æ•°æ˜¯å¯å˜çš„ï¼Œå‡½æ•°å†…éƒ¨æ‰€åšçš„æ›´æ”¹å¯¹è°ƒç”¨è€…å¯è§ã€‚æœ‰å…³[inoutå‚æ•°](#inout-arguments)çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ä¸‹é¢ã€‚

## `Int` æ˜¯ä¸€ä¸ªç±»å‹ï¼Œè€Œ `int` æ˜¯ä¸€ä¸ªåŸºæœ¬æ•°æ®ç±»å‹ã€‚

åœ¨Mojoä¸­ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬ä½¿ç”¨`Int`ï¼ˆå¤§å†™â€œIâ€ï¼‰ï¼Œè¿™ä¸Pythonçš„`int`ï¼ˆå°å†™â€œiâ€ï¼‰ä¸åŒã€‚è¿™ç§å·®å¼‚æ˜¯æœ‰ç›®çš„çš„ï¼Œè€Œä¸”å®é™…ä¸Šæ˜¯ä»¶å¥½äº‹ï¼


åœ¨Pythonä¸­ï¼Œ`int`ç±»å‹å¯ä»¥å¤„ç†éå¸¸å¤§çš„æ•°å­—ï¼Œå¹¶å…·æœ‰ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼Œæ¯”å¦‚æ£€æŸ¥ä¸¤ä¸ªæ•°å­—æ˜¯å¦ä¸ºåŒä¸€ä¸ªå¯¹è±¡ã€‚ä½†è¿™ä¼´éšç€ä¸€äº›é¢å¤–çš„è´Ÿæ‹…ï¼Œå¯èƒ½ä¼šå‡æ…¢äº‹æƒ…çš„è¿›åº¦ã€‚Mojoçš„`Int`åˆ™ä¸åŒã€‚å®ƒè¢«è®¾è®¡ä¸ºç®€å•ã€å¿«é€Ÿï¼Œå¹¶ä¸”é’ˆå¯¹æ‚¨çš„è®¡ç®—æœºç¡¬ä»¶è¿›è¡Œäº†ä¼˜åŒ–ï¼Œä»¥ä¾¿å¿«é€Ÿå¤„ç†ã€‚

æˆ‘ä»¬åšå‡ºè¿™ä¸ªé€‰æ‹©çš„ä¸¤ä¸ªä¸»è¦åŸå› æ˜¯ï¼š

1. æˆ‘ä»¬å¸Œæœ›ä¸ºéœ€è¦ä¸è®¡ç®—æœºç¡¬ä»¶ç´§å¯†åˆä½œçš„ç¨‹åºå‘˜ï¼ˆç³»ç»Ÿç¨‹åºå‘˜ï¼‰æä¾›ä¸€ç§é€æ˜å¯é çš„ä¸ç¡¬ä»¶äº¤äº’çš„æˆ‘ä»¬ä¸æƒ³ä¾èµ–äºèŠ±å“¨çš„æŠ€å·§ï¼ˆæ¯”å¦‚JITç¼–è¯‘å™¨ï¼‰æ¥ä½¿äº‹æƒ…å˜å¾—æ›´å¿«ã€‚

1. æˆ‘ä»¬å¸Œæœ›Mojoèƒ½å¤Ÿä¸Pythonæ— ç¼é…åˆï¼Œä¸ä¼šå‡ºç°ä»»ä½•é—®é¢˜ã€‚é€šè¿‡ä½¿ç”¨ä¸åŒçš„åç§°ï¼ˆIntè€Œä¸æ˜¯intï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸æ”¹å˜Pythonçš„intå·¥ä½œæ–¹å¼çš„æƒ…å†µä¸‹å°†ä¸¤ç§ç±»å‹éƒ½ä¿ç•™åœ¨Mojoä¸­ã€‚

ä½œä¸ºé¢å¤–å¥–åŠ±ï¼Œ`Int` éµå¾ªä¸ Mojo ä¸­ä½ å¯èƒ½åˆ›å»ºçš„å…¶ä»–è‡ªå®šä¹‰æ•°æ®ç±»å‹ç›¸åŒçš„å‘½åé£æ ¼ã€‚æ­¤å¤–ï¼Œ`Int`æ˜¯Mojoæ ‡å‡†å·¥å…·é›†ä¸­åŒ…å«çš„`struct`ã€‚

## å¼ºç±»å‹æ£€æŸ¥


å°½ç®¡ä½ ä»ç„¶å¯ä»¥åƒåœ¨Pythonä¸­ä¸€æ ·ä½¿ç”¨çµæ´»çš„ç±»å‹ï¼Œä½†Mojoè®©ä½ ä½¿ç”¨ä¸¥æ ¼çš„ç±»å‹æ£€æŸ¥ã€‚ç±»å‹æ£€æŸ¥å¯ä»¥ä½¿æ‚¨çš„ä»£ç æ›´åŠ å¯é¢„æµ‹ã€å¯ç®¡ç†å’Œå®‰å…¨ã€‚


Mojoçš„`struct`ç±»å‹æ˜¯é‡‡ç”¨å¼ºç±»å‹æ£€æŸ¥çš„ä¸»è¦æ–¹æ³•ä¹‹ä¸€ã€‚Mojoä¸­çš„`struct`å®šä¹‰å®šä¹‰äº†ä¸€ä¸ªç¼–è¯‘æ—¶ç»‘å®šçš„åç§°ï¼Œå¹¶ä¸”åœ¨ç±»å‹ä¸Šä¸‹æ–‡ä¸­å¯¹è¯¥åç§°çš„å¼•ç”¨è¢«è§†ä¸ºå¯¹æ­£åœ¨å®šä¹‰çš„å€¼çš„ä¾‹å¦‚ï¼Œè€ƒè™‘ä½¿ç”¨ä¸Šé¢æ˜¾ç¤ºçš„`MyPair`ç»“æ„çš„ä»¥ä¸‹ä»£ç ï¼š

```auto
def pairTest() -> Bool:
    let p = MyPair(1, 2)
    return p < 4 # gives a compile-time error
```

å½“ä½ è¿è¡Œè¿™æ®µä»£ç æ—¶ï¼Œä½ ä¼šå¾—åˆ°ä¸€ä¸ªç¼–è¯‘æ—¶é”™è¯¯ï¼Œå‘Šè¯‰ä½ â€œ4â€æ— æ³•è½¬æ¢ä¸º`MyPair`ï¼Œè€Œè¿™æ˜¯`MyPair.__lt__`å³ä¾§æ‰€éœ€çš„


è¿™æ˜¯ä½¿ç”¨ç³»ç»Ÿç¼–ç¨‹è¯­è¨€å·¥ä½œæ—¶çš„ä¸€ç§å¸¸è§ç»å†ï¼Œä½†è¿™ä¸æ˜¯Pythonçš„å·¥ä½œæ–¹å¼ã€‚Pythonå…·æœ‰ç”¨äº[MyPy](https://mypy.readthedocs.io/)ç±»å‹æ³¨é‡Šçš„è¯­æ³•ä¸Šå®Œå…¨ç›¸åŒçš„ç‰¹æ€§ï¼Œä½†å®ƒä»¬ä¸ä¼šè¢«ç¼–è¯‘å™¨é€šè¿‡å°†ç±»å‹ä¸ç‰¹å®šå£°æ˜ç›¸å…³è”ï¼ŒMojoå¯ä»¥å¤„ç†ç»å…¸çš„ç±»å‹æ³¨é‡Šæç¤ºå’Œå¼ºç±»å‹è§„èŒƒï¼Œè€Œä¸ç ´åå…¼å®¹æ€§

å¼ºç±»å‹ä¸ä»…ä»…ç”¨äºç±»å‹æ£€æŸ¥ã€‚ç”±äºæˆ‘ä»¬çŸ¥é“ç±»å‹æ˜¯å‡†ç¡®çš„ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥æ ¹æ®è¿™äº›ç±»å‹ä¼˜åŒ–ä»£ç ï¼Œå°†å€¼ä¼ é€’åˆ°å¯„å­˜å™¨ä¸­ï¼Œå¹¶ä¸”åœ¨å‚è¿™æ˜¯Mojoä¸ºç³»ç»Ÿç¨‹åºå‘˜æä¾›çš„å®‰å…¨å’Œå¯é¢„æµ‹æ€§ä¿è¯çš„åŸºç¡€ã€‚

## Overloadedå‡½æ•°å’Œæ–¹æ³•


åƒPythonä¸€æ ·ï¼Œåœ¨Mojoä¸­å¯ä»¥å®šä¹‰å‡½æ•°è€Œæ— éœ€æŒ‡å®šå‚æ•°æ•°æ®ç±»å‹ï¼ŒMojoå°†è‡ªåŠ¨å¤„ç†å®ƒä»¬ã€‚å½“ä½ æƒ³è¦è¡¨è¾¾å¼çš„ APIï¼Œåªéœ€æ¥å—ä»»æ„è¾“å…¥ï¼Œè®©åŠ¨æ€åˆ†æ´¾å†³å®šå¦‚ä½•å¤„ç†æ•°æ®æ—¶ï¼Œè¿™æ˜¯å¾ˆä¸é”™çš„ã€‚ç„¶è€Œï¼Œå½“æ‚¨æƒ³è¦ç¡®ä¿ç±»å‹å®‰å…¨æ—¶ï¼Œæ­£å¦‚ä¸Šé¢æ‰€è®¨è®ºçš„ï¼ŒMojoä¹Ÿæä¾›äº†å¯¹é‡è½½å‡½æ•°å’Œæ–¹æ³•çš„å®Œæ•´æ”¯æŒã€‚


è¿™å…è®¸æ‚¨ä½¿ç”¨ç›¸åŒçš„åç§°å®šä¹‰å¤šä¸ªå…·æœ‰ä¸åŒå‚æ•°çš„å‡½æ•°ã€‚è¿™æ˜¯è®¸å¤šè¯­è¨€ï¼ˆå¦‚C++ã€Javaå’ŒSwiftï¼‰ä¸­å¸¸è§çš„ç‰¹æ€§ã€‚


åœ¨è§£æå‡½æ•°è°ƒç”¨æ—¶ï¼ŒMojoä¼šå°è¯•æ¯ä¸ªå€™é€‰è€…ï¼Œå¦‚æœåªæœ‰ä¸€ä¸ªå¯ä»¥å·¥ä½œï¼Œå®ƒä¼šä½¿ç”¨è¯¥å€™é€‰è€…ï¼›å¦‚æœå¯ä»¥ç¡®.åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨è°ƒç”¨ç«™ç‚¹ä¸Šæ·»åŠ æ˜¾å¼è½¬æ¢æ¥è§£å†³æ­§ä¹‰ã€‚è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```auto
struct Array[T: AnyType]:
    fn __getitem__(self, idx: Int) -> T: ...
    fn __getitem__(self, idx: Range) -> ArraySlice: ...
```

ä½ å¯ä»¥åœ¨ç»“æ„ä½“å’Œç±»ä¸­é‡è½½æ–¹æ³•ï¼Œä»¥åŠé‡è½½æ¨¡å—çº§å‡½æ•°ã€‚


Mojoä¸ä»…ä»…æ”¯æŒç»“æœç±»å‹çš„é‡è½½ï¼Œè€Œä¸”ä¸ä½¿ç”¨ç»“æœç±»å‹æˆ–ä¸Šä¸‹æ–‡ç±»å‹ä¿¡æ¯è¿›è¡Œç±»å‹æ¨æ–­ï¼Œä»è€Œä½¿äº‹Mojoæ°¸è¿œä¸ä¼šäº§ç”Ÿâ€œè¡¨è¾¾å¼å¤ªå¤æ‚â€çš„é”™è¯¯ï¼Œå› ä¸ºå®ƒçš„ç±»å‹æ£€æŸ¥å™¨åœ¨å®šä¹‰ä¸Šæ˜¯ç®€å•è€Œå¿«é€Ÿçš„ã€‚


å¦‚æœä½ æ²¡æœ‰ç»™å‚æ•°å®šä¹‰ç±»å‹ï¼Œé‚£ä¹ˆè¿™ä¸ªå‡½æ•°çš„è¡Œä¸ºå°±å’ŒPythonä¸­çš„åŠ¨æ€ç±»å‹ä¸€æ ·ã€‚ä¸€æ—¦å®šä¹‰äº†å•ä¸ªå‚æ•°ç±»å‹ï¼ŒMojo å°±ä¼šæŸ¥æ‰¾é‡è½½å€™é€‰é¡¹å¹¶æŒ‰ç…§ä¸Šè¿°æ–¹å¼è§£æå‡½æ•°è°ƒç”¨ã€‚


å‡½æ•°å’Œæ–¹æ³•å¯ä»¥æ ¹æ®å‚æ•°å’Œå‚æ•°ç­¾åè¿›è¡Œé‡è½½ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ä»¥åŠå…³äºé‡è½½è§£æè§„åˆ™çš„æè¿°ï¼Œè¯·å‚è§[å‚æ•°é‡è½½](#overloading-on-parameters)ã€‚

## `fn` å®šä¹‰


ä¸Šè¿°æ‰©å±•æ˜¯æä¾›ä½çº§ç¼–ç¨‹å’ŒæŠ½è±¡èƒ½åŠ›çš„åŸºçŸ³ï¼Œä½†è®¸å¤šç³»ç»Ÿç¨‹åºå‘˜æ¯”Mojoä¸­çš„`def`æ›´å–œæ¬¢æ›´å¤šçš„æ§åˆ¶å’Œå¯é¢„æµ‹æ€§ã€‚ç®€è€Œè¨€ä¹‹ï¼Œ`def`è¢«è®¾è®¡æˆéå¸¸åŠ¨æ€ã€çµæ´»ï¼Œå¹¶ä¸”ä¸Pythonçš„ä¸€èˆ¬è§„åˆ™å…¼å®¹ï¼šå‚æ•°æ˜¯å¯å˜çš„ï¼Œå±€éƒ¨å˜é‡åœ¨é¦–æ¬¡ä½¿ç”¨æ—¶éšå¼å£°æ˜ï¼Œä¸”ä½œç”¨åŸŸå¹¶ä¸å—é™åˆ¶ã€‚è¿™å¯¹äºé«˜çº§ç¼–ç¨‹å’Œè„šæœ¬ç¼–å†™å¾ˆæ£’ï¼Œä½†ä¸æ€»æ˜¯å¾ˆé€‚åˆç³»ç»Ÿç¼–ç¨‹ã€‚ä¸ºäº†è¡¥å……ï¼ŒMojoæä¾›äº†ä¸€ä¸ª`fn`å£°æ˜ï¼Œå®ƒå°±åƒ`def`çš„â€œä¸¥æ ¼æ¨¡å¼â€ã€‚

å¦ä¸€ç§æ–¹æ¡ˆï¼šä¸å…¶ä½¿ç”¨æ–°çš„å…³é”®å­—`fn`ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ç°æœ‰çš„å‡½æ•°å®šä¹‰ä¸­æ·»åŠ ä¸€ä¸ªä¿®é¥°ç¬¦æˆ–è£…é¥°å™¨`@strict def`ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦é‡‡ç”¨æ–°çš„å…³é”®å­—ï¼Œè€Œä¸”è¿™æ ·åšçš„æˆæœ¬å¾ˆä½ã€‚åœ¨ç³»ç»Ÿç¼–ç¨‹é¢†åŸŸçš„å®è·µä¸­ï¼Œ`fn`ç»å¸¸è¢«ä½¿ç”¨ï¼Œå› æ­¤å°†å…¶çº³å…¥ç¬¬ä¸€ç±»å¯èƒ½æ˜¯æ˜æ™ºçš„ã€‚

å°±è°ƒç”¨è€…è€Œè¨€ï¼Œ`fn` å’Œ `def` æ˜¯å¯ä»¥äº’æ¢çš„ï¼šæ²¡æœ‰ä»»ä½•ä¸€ä¸ª `def` èƒ½æä¾›çš„ `fn` æ— æ³•æä¾›çš„ï¼ˆåä¹‹äº¦ç„¶ï¼‰ã€‚`fn`çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œå®ƒåœ¨å…¶å‡½æ•°ä½“å†…éƒ¨æ›´åŠ å—é™å’Œå—æ§ï¼ˆæˆ–è€…è¯´ï¼šæ›´åŠ æ‹˜æ³¥å’Œä¸¥æ ¼ï¼‰ã€‚ä¸`def`å‡½æ•°ç›¸æ¯”ï¼Œ`fn`æœ‰è®¸å¤šé™åˆ¶ï¼š

1. å‡½æ•°ä½“å†…çš„å‚æ•°å€¼é»˜è®¤ä¸ºä¸å¯å˜ï¼ˆç±»ä¼¼äº`let`ï¼‰ï¼Œè€Œä¸æ˜¯å¯å˜ï¼ˆç±»ä¼¼äº`var`ï¼‰ã€‚è¿™å¯ä»¥æ•è·æ„å¤–çš„å˜å¼‚ï¼Œå¹¶å…è®¸ä½¿ç”¨ä¸å¯å¤åˆ¶çš„ç±»å‹ä½œä¸ºå‚æ•°ã€‚
1. å‚æ•°å€¼éœ€è¦æŒ‡å®šç±»å‹ï¼ˆé™¤äº†æ–¹æ³•ä¸­çš„`self`å¤–ï¼‰ï¼Œä»¥æ•è·æ„å¤–çœç•¥ç±»å‹è§„èŒƒã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœç¼ºå°‘è¿”å›ç±»å‹è¯´æ˜ç¬¦ï¼Œåˆ™è§£é‡Šä¸ºè¿”å›`None`è€Œä¸æ˜¯æœªçŸ¥çš„è¿”å›ç±»å‹ã€‚æ³¨æ„ï¼Œä¸¤è€…éƒ½å¯ä»¥æ˜¾å¼å£°æ˜è¿”å›`object`ï¼Œè¿™å…è®¸äººä»¬æœ‰é€‰æ‹©åœ°é‡‡ç”¨`def`çš„è¡Œä¸ºã€‚
1. ç¦æ­¢éšå¼å£°æ˜å±€éƒ¨å˜é‡ï¼Œå› æ­¤æ‰€æœ‰å±€éƒ¨å˜é‡å¿…é¡»æ˜ç¡®å£°æ˜ã€‚è¿™æ•è·åç§°é”™è¯¯ï¼Œå¹¶ä¸`let`å’Œ`var`æä¾›çš„ä½œç”¨åŸŸç›¸åè°ƒã€‚
1. ä¸¤è€…éƒ½æ”¯æŒæŠ›å‡ºå¼‚å¸¸ï¼Œä½†å¿…é¡»åœ¨`fn`ä¸Šä½¿ç”¨`raises`å…³é”®å­—æ˜ç¡®å£°æ˜ã€‚



ç¼–ç¨‹æ¨¡å¼åœ¨å›¢é˜Ÿä¹‹é—´ä¼šæœ‰å¾ˆå¤§çš„å·®å¼‚ï¼Œè€Œè¿™ç§ä¸¥æ ¼ç¨‹åº¦ä¸é€‚ç”¨äºæ‰€æœ‰äººã€‚æˆ‘ä»¬é¢„è®¡ä¹ æƒ¯äºC++çš„äººä»¬ä¼šæ›´å€¾å‘äºä½¿ç”¨`fn`ï¼Œè€Œé«˜çº§ç¨‹åºå‘˜å’Œæœºå™¨å­¦ä¹ ç ”ç©¶äººå‘˜ä¼šç»§ç»­ä½¿ç”¨`def`ã€‚Mojoå…è®¸æ‚¨è‡ªç”±åœ°æ··åˆ`def`å’Œ`fn`å£°æ˜ï¼Œä¾‹å¦‚ã€‚å®ç°ä¸€äº›æ–¹æ³•ç”¨ä¸€ç§ï¼Œå¦ä¸€äº›æ–¹æ³•ç”¨å¦ä¸€ç§ï¼Œå¹¶å…è®¸æ¯ä¸ªå›¢é˜Ÿæˆ–ç¨‹åºå‘˜å†³å®šä»€ä¹ˆæœ€é€‚åˆä»–ä»¬çš„ç”¨ä¾‹ã€‚

æœ‰å…³Mojoå‡½æ•°ä¸­å‚æ•°è¡Œä¸ºçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ä¸‹é¢å…³äº[å‚æ•°ä¼ é€’æ§åˆ¶å’Œå†…å­˜æ‰€æœ‰æƒ](#argument-passing-control-and-memory-ownership)çš„éƒ¨åˆ†ã€‚

## `__copyinit__`å’Œ`__moveinit__`ç‰¹æ®Šæ–¹æ³•

Mojoæ”¯æŒåƒC++å’ŒSwiftè¿™æ ·çš„è¯­è¨€ä¸­çš„å®Œæ•´â€œå€¼è¯­ä¹‰â€ï¼Œå¹¶ä¸”å®ƒé€šè¿‡ä½¿ç”¨`@value`è£…é¥°å™¨ï¼ˆå¦‚ä¸‹æ–‡è¯¦ç»†æè¿°ï¼‰ï¼Œä½¿å¾—å®šä¹‰å­—æ®µçš„ç®€å•èšåˆå˜å¾—éå¸¸å®¹æ˜“ã€‚

å¯¹äºé«˜çº§ç”¨ä¾‹ï¼ŒMojoå…è®¸æ‚¨å®šä¹‰è‡ªå®šä¹‰æ„é€ å‡½æ•°ï¼ˆä½¿ç”¨Pythonçš„ç°æœ‰`__init__`ç‰¹æ®Šæ–¹æ³•ï¼‰ã€è‡ªå®šä¹‰ææ„å‡½æ•°ï¼ˆä½¿ç”¨ç°æœ‰çš„`__del__`ç‰¹æ®Šæ–¹æ³•ï¼‰ä»¥åŠä½¿ç”¨æ–°çš„`__copyinit__`å’Œ`__moveinit__`ç‰¹æ®Šæ–¹æ³•æ¥å®šä¹‰è‡ªå®šä¹‰å¤åˆ¶å’Œç§»åŠ¨æ„é€ å‡½æ•°ã€‚

è¿™äº›ä½çº§åˆ«çš„å®šåˆ¶é’©å­åœ¨è¿›è¡Œä½çº§åˆ«çš„ç³»ç»Ÿç¼–ç¨‹æ—¶å¾ˆæœ‰ç”¨ï¼Œä¾‹å¦‚åœ¨ç¼–å†™è®¾å¤‡é©±åŠ¨ç¨‹åºæ—¶ã€‚æ‰‹åŠ¨å†…å­˜ç®¡ç†ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªéœ€è¦åœ¨æ„é€ æ—¶ä¸ºå­—ç¬¦ä¸²æ•°æ®åˆ†é…å†…å­˜ï¼Œå¹¶åœ¨å€¼è¢«é”€æ¯æ—¶é”€æ¯å®ƒçš„åŠ¨æ€å­—ç¬¦ä¸²ç±»

```auto
struct MyString:
    var data: Pointer[UI8]

    # StringRef has a data + length field
    def __init__(inout self, input: StringRef):
        let data = Pointer[UI8].alloc(input.length+1)
        data.memcpy(input.data, input.length)
        data[input.length] = 0
        self.data = Pointer[UI8](data)

    def __del__(owned self):
        self.data.free()
```


è¿™ä¸ª`MyString`ç±»å‹ä½¿ç”¨ä½çº§å‡½æ•°å®ç°ï¼Œä»¥å±•ç¤ºè¿™ç§å·¥ä½œæ–¹å¼çš„ç®€å•ç¤ºä¾‹â€”â€”ä¸€ä¸ªæ›´ç°å®çš„å®ç°å°†ä½¿ç”¨çŸ­å­—ç¬¦ä¸²ã€‚ç„¶è€Œï¼Œå¦‚æœä½ ç»§ç»­å°è¯•ï¼Œä½ å¯èƒ½ä¼šæ„Ÿåˆ°æƒŠè®¶ï¼š

```auto
fn useStrings():
    var a: MyString = "hello"
    print(a)   # Should print "hello"
    var b = a  # ERROR: MyString doesn't implement __copyinit__

    a = "Goodbye"
    print(b)   # Should print "hello"
    print(a)   # Should print "Goodbye"
```

Mojoç¼–è¯‘å™¨ä¸å…è®¸æˆ‘ä»¬ä»`a`å¤åˆ¶å­—ç¬¦ä¸²åˆ°`b`ï¼Œå› ä¸ºå®ƒä¸çŸ¥é“å¦‚ä½•å¤„ç†è¯¥æ“ä½œã€‚`MyString`åŒ…å«ä¸€ä¸ª`Pointer`å®ä¾‹ï¼ˆç­‰ä»·äºä½çº§CæŒ‡é’ˆï¼‰ï¼Œè€ŒMojoä¸çŸ¥é“å®ƒæŒ‡å‘ä»€ä¹ˆæ•°æ®æˆ–å¦‚ä½•å¤åˆ¶å®ƒã€‚æ›´ä¸€èˆ¬åœ°è¯´ï¼ŒæŸäº›ç±»å‹ï¼ˆå¦‚åŸå­å·ï¼‰ä¸èƒ½å¤åˆ¶æˆ–ç§»åŠ¨ï¼Œå› ä¸ºå®ƒä»¬çš„åœ°å€æä¾›äº†ä¸€ç§èº«ä»½ï¼Œå°±åƒç±»å®ä¾‹


åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç¡®å®å¸Œæœ›æˆ‘ä»¬çš„å­—ç¬¦ä¸²å¯ä»¥å¤åˆ¶ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å®ç°äº†`__copyinit__`ç‰¹æ®Šæ–¹æ³•ï¼Œé€šå¸¸çš„å®ç°æ–¹å¼å¦‚ä¸‹ï¼š

```auto
struct MyString:
    ...
    def __copyinit__(inout self, existing: Self):
        self.data = Pointer(strdup(existing.data.address))
```


ä½¿ç”¨è¿™ç§å®ç°ï¼Œæˆ‘ä»¬ä¸Šé¢çš„ä»£ç å¯ä»¥æ­£ç¡®å·¥ä½œï¼Œè€Œ`b = a`å¤åˆ¶äº§ç”Ÿäº†ä¸€ä¸ªé€»è¾‘ä¸Šç‹¬ç«‹çš„å­—ç¬¦ä¸²å®ä¾‹ï¼Œå®ƒæœ‰ç€è‡ªå·±çš„ç”Ÿå‘½å‘¨æœŸå’Œæ•°æ®ã€‚ä¸Šé¢çš„ä»£ç æŒ‡ç¤ºä½¿ç”¨Cé£æ ¼çš„`strdup()`å‡½æ•°è¿›è¡Œå¤åˆ¶ã€‚MojoåŒæ ·æ”¯æŒ`__moveinit__`æ–¹æ³•ï¼Œå®ƒå…è®¸Rusté£æ ¼çš„ç§»åŠ¨ï¼ˆåœ¨ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶è·å–ä¸€ä¸ªå€¼ï¼‰å’ŒC++é£æ ¼çš„ç§»åŠ¨ï¼ˆç§»æœ‰å…³å€¼ç”Ÿå‘½å‘¨æœŸçš„æ›´å¤šè®¨è®ºï¼Œè¯·å‚è§ä¸‹é¢çš„[å€¼ç”Ÿå‘½å‘¨æœŸ](#value-lifecycle)éƒ¨åˆ†ã€‚


Mojoæä¾›å¯¹å€¼çš„ç”Ÿå‘½å‘¨æœŸçš„å®Œå…¨æ§åˆ¶ï¼ŒåŒ…æ‹¬ä½¿ç±»å‹å¯å¤åˆ¶ã€åªèƒ½ç§»åŠ¨å’Œä¸å¯ç§»åŠ¨çš„èƒ½åŠ›ã€‚è¿™æ¯”åƒSwiftå’ŒRustè¿™æ ·çš„è¯­è¨€æä¾›çš„æ§åˆ¶åŠ›æ›´å¼ºï¼Œå®ƒä»¬è¦æ±‚å€¼è‡³å°‘æ˜¯å¯ç§»åŠ¨çš„ã€‚å¦‚æœä½ æƒ³çŸ¥é“`existing`å¦‚ä½•åœ¨ä¸åˆ›å»ºå‰¯æœ¬çš„æƒ…å†µä¸‹ä¼ å…¥`__copyinit__`æ–¹æ³•ï¼Œè¯·æŸ¥çœ‹ä¸‹é¢[å€Ÿç”¨å‚æ•°](#borrowed-arguments)ä¸€èŠ‚ã€‚

## å‚æ•°ä¼ é€’æ§åˆ¶å’Œå†…å­˜æ‰€æœ‰æƒ

åœ¨Pythonå’ŒMojoä¸­ï¼Œå¤§éƒ¨åˆ†è¯­è¨€éƒ½å›´ç»•å‡½æ•°è°ƒç”¨ï¼šè®¸å¤šï¼ˆè¡¨é¢ä¸Šï¼‰å†…ç½®çš„è¡Œä¸ºéƒ½æ˜¯ä½¿ç”¨â€œåŒä¸‹åˆ’çº¿â€ã€‚åœ¨è¿™äº›é­”æ³•å‡½æ•°å†…éƒ¨ï¼Œé€šè¿‡å‚æ•°ä¼ é€’ç¡®å®šäº†å¤§é‡çš„å†…å­˜æ‰€æœ‰æƒã€‚

è®©æˆ‘ä»¬å¤ä¹ ä¸€ä¸‹å…³äºPythonå’ŒMojoå¦‚ä½•ä¼ é€’å‚æ•°çš„ä¸€äº›ç»†èŠ‚ï¼š

+ æ‰€æœ‰ä¼ å…¥*Python* `def`å‡½æ•°çš„å€¼éƒ½ä½¿ç”¨å¼•ç”¨è¯­ä¹‰ã€‚è¿™æ„å‘³ç€è¯¥å‡½æ•°å¯ä»¥ä¿®æ”¹ä¼ å…¥å…¶ä¸­çš„å¯å˜å¯¹è±¡ï¼Œå¹¶ä¸”è¿™äº›æ›´æ”¹åœ¨å‡½æ•°å¤–å¯è§ã€‚ç„¶è€Œï¼Œå¯¹äºä¸ç†Ÿæ‚‰çš„äººæ¥è¯´ï¼Œè¿™ç§è¡Œä¸ºæœ‰æ—¶ä»¤äººæƒŠè®¶ï¼Œå› ä¸ºä½ å¯ä»¥æ”¹å˜å‚æ•°æŒ‡å‘çš„å¯¹è±¡ï¼Œè€Œè¿™ä¸ªæ”¹å˜åœ¨å‡½æ•°å¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚

+ é»˜è®¤æƒ…å†µä¸‹ï¼Œä¼ å…¥*Mojo* `def`å‡½æ•°çš„æ‰€æœ‰å€¼éƒ½ä½¿ç”¨å€¼è¯­ä¹‰ã€‚ä¸Pythonç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡è¦çš„åŒºåˆ«ï¼šMojoçš„`def`å‡½æ•°æ¥æ”¶æ‰€æœ‰å‚æ•°çš„å‰¯æœ¬â€”â€”å®ƒå¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä¿®æ”¹å‚æ•°ï¼Œä½†æ˜¯å‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„ä¿®æ”¹åœ¨å‡½æ•°å¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚

+ æ‰€æœ‰ä¼ å…¥Mojo [`fn`å‡½æ•°](#fn-definitions)çš„å€¼é»˜è®¤æƒ…å†µä¸‹éƒ½æ˜¯ä¸å¯å˜çš„å¼•ç”¨ã€‚è¿™æ„å‘³ç€è¯¥å‡½æ•°å¯ä»¥è¯»å–åŸå§‹å¯¹è±¡ï¼ˆå®ƒä¸æ˜¯å‰¯æœ¬ï¼‰ï¼Œä½†å®ƒæ— æ³•å¯¹å¯¹è±¡è¿›è¡Œä»»ä½•ä¿®æ”¹ã€‚


è¿™ç§åœ¨Mojo `fn`ä¸­ä¸å¯å˜å‚æ•°ä¼ é€’çš„çº¦å®šè¢«ç§°ä¸ºâ€œå€Ÿç”¨â€ã€‚åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è§£é‡Šå¦‚ä½•æ›´æ”¹Mojoä¸­`def`å’Œ `fn`å‡½æ•°

## ä¸ºä»€ä¹ˆå‚æ•°çº¦å®šå¾ˆé‡è¦


åœ¨Pythonä¸­ï¼Œæ‰€æœ‰åŸºæœ¬å€¼éƒ½æ˜¯å¯¹è±¡çš„å¼•ç”¨â€”â€”å¦‚ä¸Šæ‰€è¿°ï¼ŒPythonå‡½æ•°å¯ä»¥ä¿®æ”¹åŸå§‹å¯¹è±¡ã€‚å› æ­¤ï¼ŒPythonå¼€å‘äººå‘˜ä¹ æƒ¯äºå°†ä¸€åˆ‡éƒ½è§†ä¸ºå¼•ç”¨è¯­ä¹‰ã€‚ç„¶è€Œï¼Œåœ¨CPythonæˆ–æœºå™¨çº§åˆ«ä¸Šï¼Œæ‚¨å¯ä»¥çœ‹åˆ°å¼•ç”¨æœ¬èº«å®é™…ä¸Šæ˜¯*æŒ‰å‰¯æœ¬*ä¼ é€’çš„ï¼Œå³Pythonå¤åˆ¶ä¸€ä¸ªæŒ‡é’ˆå¹¶è°ƒæ•´å¼•ç”¨è®¡æ•°ã€‚

è¿™ç§Pythonæ–¹æ³•ä¸ºå¤§å¤šæ•°äººæä¾›äº†ä¸€ç§èˆ’é€‚çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä½†å®ƒè¦æ±‚æ‰€æœ‰å€¼éƒ½å¿…é¡»åœ¨å †ä¸Šåˆ†é…ï¼ˆç”±äºå¼•ç”¨å…±äº«ã€‚Mojo classesï¼ˆTODOï¼šwillï¼‰éµå¾ªç›¸åŒçš„å¼•ç”¨è¯­ä¹‰æ–¹æ³•æ¥å¤„ç†å¤§å¤šæ•°å¯¹è±¡ï¼Œä½†æ˜¯åœ¨ç³»ç»Ÿç¼–ç¨‹ä¸Šä¸‹æ–‡ä¸­ï¼Œå¯¹äºç®€å•ç±»å‹å¦‚æ•´å‹ï¼Œè¿™ç§æ–¹å¼å¹¶ä¸å®ç”¨ã€‚åœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è¿™äº›å€¼å­˜æ”¾åœ¨å †æ ˆä¸­æˆ–è€…ç”šè‡³æ˜¯ç¡¬ä»¶å¯„å­˜å™¨ä¸­ã€‚å› æ­¤ï¼ŒMojo structsæ€»æ˜¯è¢«å†…è”åˆ°å®ƒä»¬çš„å®¹å™¨ä¸­ï¼Œæ— è®ºæ˜¯ä½œä¸ºå¦ä¸€ç§ç±»å‹çš„å­—æ®µè¿˜æ˜¯è¢«å†…è”åˆ°åŒ…å«å‡½æ•°çš„å †æ ˆå¸§ä¸­ã€‚

è¿™å¼•å‘äº†ä¸€äº›æœ‰è¶£çš„é—®é¢˜ï¼šå¦‚ä½•å®ç°éœ€è¦ä¿®æ”¹ç»“æ„ç±»å‹`self`çš„æ–¹æ³•ï¼Œæ¯”å¦‚`__iadd__`ï¼Ÿ`let`æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œé‚£å®ƒå¦‚ä½•é˜²æ­¢çªå˜ï¼Ÿå¦‚ä½•æ§åˆ¶è¿™äº›å€¼çš„ç”Ÿå‘½å‘¨æœŸä»¥ä¿æŒ Mojo çš„å†…å­˜å®‰å…¨æ€§ï¼Ÿ


ç­”æ¡ˆæ˜¯ï¼ŒMojoç¼–è¯‘å™¨ä½¿ç”¨æ•°æ®æµåˆ†æå’Œç±»å‹æ³¨é‡Šï¼Œä»¥æä¾›å¯¹å€¼å¤åˆ¶ã€å¼•ç”¨åˆ«åå’Œçªå˜æ§åˆ¶çš„å®Œå…¨æ§è¿™äº›ç‰¹æ€§åœ¨è®¸å¤šæ–¹é¢ä¸Rustè¯­è¨€ä¸­çš„ç‰¹æ€§ç›¸ä¼¼ï¼Œä½†å®ƒä»¬çš„å·¥ä½œæ–¹å¼æœ‰æ‰€ä¸åŒï¼Œä»¥ä¾¿ä½¿Mojoæ›´å®¹æ˜“å­¦ä¹ ï¼Œå¹¶ä¸”å®ƒä»¬æ›´å¥½åœ°ä¸Pythonç”Ÿæ€ç³»ç»Ÿé›†æˆï¼Œè€Œæ— éœ€æ‰¿æ‹…æ²‰é‡çš„æ³¨è§£è´Ÿæ‹…ã€‚

åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæ‚¨å°†å­¦ä¹ å¦‚ä½•æ§åˆ¶ä¼ å…¥Mojo `fn`å‡½æ•°çš„å¯¹è±¡çš„å†…å­˜æ‰€æœ‰æƒã€‚

## ä¸å¯å˜å‚æ•°ï¼ˆå€Ÿç”¨ï¼‰


ä¸€ä¸ªå€Ÿç”¨çš„å¯¹è±¡æ˜¯ä¸€ä¸ªå‡½æ•°æ¥æ”¶åˆ°çš„å¯¹è±¡çš„**ä¸å¯å˜å¼•ç”¨**ï¼Œè€Œä¸æ˜¯æ¥æ”¶åˆ°å¯¹è±¡çš„å‰¯æœ¬ã€‚å› æ­¤ï¼Œè¢«è°ƒç”¨çš„å‡½æ•°å¯¹è¯¥å¯¹è±¡å…·æœ‰å®Œå…¨çš„è¯»å–å’Œæ‰§è¡Œè®¿é—®æƒé™ï¼Œä½†å®ƒä¸èƒ½ä¿®æ”¹å®ƒï¼ˆè°ƒç”¨è€…ä»ç„¶å¯¹è¯¥å¯¹è±¡æ‹¥æœ‰ç‹¬å çš„â€œæ‰€æœ‰æƒâ€ã€‚ï¼‰

å°½ç®¡è¿™æ˜¯`fn`å‚æ•°çš„é»˜è®¤è¡Œä¸ºï¼Œä½†å¦‚æœæ‚¨æ„¿æ„ï¼Œå¯ä»¥ä½¿ç”¨`borrowed`å…³é”®å­—æ˜ç¡®å®šä¹‰å®ƒï¼ˆæ‚¨è¿˜å¯ä»¥å°†`borrowed`åº”ç”¨

```auto
fn use_something_big(borrowed a: SomethingBig, b: SomethingBig):
    """'a' and 'b' are passed the same, because 'borrowed' is the default."""
    a.print_id()
    b.print_id()
```


è¿™ä¸ªé»˜è®¤å€¼é€‚ç”¨äºæ‰€æœ‰å‚æ•°ï¼ŒåŒ…æ‹¬æ–¹æ³•çš„`self`å‚æ•°ã€‚å½“ä¼ é€’å¤§å€¼æˆ–è€…ä¼ é€’æ˜‚è´µçš„å€¼ï¼ˆæ¯”å¦‚Python/Mojoç±»é»˜è®¤çš„å¼•ç”¨è®¡æ•°æŒ‡é’ˆï¼‰æ—¶ï¼Œè¿™ç§æ–¹å¼æ›´åŠ é«˜æ•ˆï¼Œå› ä¸ºä¼ ä»¥ä¸‹æ˜¯åŸºäºä¸Šé¢ä»£ç çš„æ›´è¯¦ç»†çš„ç¤ºä¾‹ï¼š

```auto
# A type that is so expensive to copy around we don't even have a
# __copyinit__ method.
struct SomethingBig:
    var id_number: Int
    var huge: InlinedArray[Int, 100000]
    fn __init__(inout self): â€¦

    # self is passed inout for mutation as described above.
    fn set_id(inout self, number: Int):
        self.id_number = number

    # Arguments like self are passed as borrowed by default.
    fn print_id(self):  # Same as: fn print_id(borrowed self):
        print(self.id_number)

fn try_something_big():
    # Big thing sits on the stack: after we construct it it cannot be
    # moved or copied.
    let big = SomethingBig()
    # We still want to do useful things with it though!
    big.print_id()
    # Do other things with it.
    use_something_big(big, big)
```


å› ä¸º`fn`å‡½æ•°çš„é»˜è®¤å‚æ•°çº¦å®šæ˜¯`å€Ÿç”¨`ï¼ŒMojoå…·æœ‰ç®€å•è€Œé€»è¾‘æ€§çš„ä»£ç ï¼Œé»˜è®¤æƒ…å†µä¸‹åšæ­£ç¡®çš„äº‹æƒ…ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¸æƒ³å¤åˆ¶æˆ–ç§»åŠ¨æ•´ä¸ª`SomethingBig`åªæ˜¯ä¸ºäº†è°ƒç”¨`print_id()`æ–¹æ³•ï¼Œæˆ–è€…åœ¨è°ƒç”¨`use_something_big()`æ—¶ã€‚


è¿™ç§å€Ÿç”¨å‚æ•°çº¦å®šåœ¨æŸäº›æ–¹é¢ä¸C++ä¸­é€šè¿‡`const&`ä¼ é€’å‚æ•°ç±»ä¼¼ï¼Œè¿™æ ·å¯ä»¥é¿å…å€¼çš„æ‹·è´ï¼Œå¹¶ä¸”åœ¨è¢«è°ƒä½†æ˜¯ï¼Œå€Ÿç”¨çš„çº¦å®šä¸C++ä¸­çš„`const&`æœ‰ä¸¤ä¸ªé‡è¦çš„ä¸åŒï¼š

1. Mojoç¼–è¯‘å™¨å®ç°äº†ä¸€ä¸ªå€Ÿç”¨æ£€æŸ¥å™¨ï¼ˆç±»ä¼¼äºRustï¼‰ï¼Œè¯¥æ£€æŸ¥å™¨å¯ä»¥é˜²æ­¢ä»£ç åœ¨å­˜åœ¨ä¸å¯å˜å¼•ç”¨çš„æƒ…å†µä¸‹ã€‚ä½ å¯ä»¥æœ‰å¤šä¸ªå€Ÿç”¨ï¼ˆå°±åƒä¸Šé¢è°ƒç”¨`use_something_big`ä¸€æ ·ï¼‰ï¼Œä½†æ˜¯ä½ ä¸èƒ½åŒæ—¶ä¼ é€’å¯å˜å¼•ç”¨å¹¶å€Ÿç”¨å®ƒã€‚ç›®å‰å°šæœªå¯ç”¨ã€‚
1. å°å€¼å¦‚`Int`ã€`Float`å’Œ`SIMD`ç›´æ¥é€šè¿‡æœºå™¨å¯„å­˜å™¨ä¼ é€’ï¼Œè€Œä¸æ˜¯é€šè¿‡é¢å¤–çš„é—´æ¥å¼•ç”¨ï¼ˆè¿™æ˜¯å› ä¸ºå®ƒä»¬ä½¿ç”¨[`@register_passable`è£…ä¸C++å’ŒRustç­‰è¯­è¨€ç›¸æ¯”ï¼Œè¿™æ˜¯ä¸€ä¸ªé‡å¤§çš„æ€§èƒ½å¢å¼ºï¼Œå°†è¿™ç§ä¼˜åŒ–ä»æ¯ä¸ªè°ƒç”¨ç«™ç‚¹ç§»åŠ¨åˆ°å£°æ˜åœ¨ç±»å‹ä¸Šã€‚

ä¸Rustç±»ä¼¼ï¼ŒMojoçš„å€Ÿç”¨æ£€æŸ¥å™¨å¼ºåˆ¶æ‰§è¡Œä¸å˜é‡çš„æ’ä»–æ€§ã€‚Rustå’ŒMojoçš„ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒMojoä¸éœ€è¦åœ¨è°ƒç”¨è€…ç«¯ä½¿ç”¨ç¬¦å·æ¥ä¼ é€’å€Ÿç”¨ã€‚æ­¤å¤–ï¼ŒMojoåœ¨ä¼ é€’å°å€¼æ—¶æ›´æœ‰æ•ˆç‡ï¼Œè€ŒRusté»˜è®¤æƒ…å†µä¸‹æ˜¯ç§»åŠ¨å€¼è€Œä¸æ˜¯é€šè¿‡å€Ÿç”¨æ¥ä¼ é€’å®ƒä»¬ã€‚è¿™äº›æ”¿ç­–å’Œè¯­æ³•å†³å®šä½¿Mojoèƒ½å¤Ÿæä¾›ä¸€ç§æ›´æ˜“äºä½¿ç”¨çš„ç¼–ç¨‹æ¨¡å‹ã€‚

## å¯å˜å‚æ•°ï¼ˆ`inout`ï¼‰

å¦ä¸€æ–¹é¢ï¼Œå¦‚æœæ‚¨å®šä¹‰äº†ä¸€ä¸ª`fn`å‡½æ•°ï¼Œå¹¶å¸Œæœ›ä¸€ä¸ªå‚æ•°æ˜¯å¯å˜çš„ï¼ˆä¸ºäº†ä½¿å‡½æ•°å†…éƒ¨å¯¹å‚æ•°çš„æ›´æ”¹åœ¨å‡½æ•°å¤–éƒ¨å¯è§ï¼‰ï¼Œæ‚¨å¿…é¡»ä½¿ç”¨ `inout` å…³é”®å­—å°†å‚æ•°å£°æ˜ä¸ºå¯å˜çš„ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå…¶ä¸­`__iadd__`å‡½æ•°è¯•å›¾ä¿®æ”¹`self`ï¼š

```auto
struct Int:
    # self and rhs are both immutable in __add__.
    fn __add__(self, rhs: Int) -> Int: ...

    # ... but this cannot work for __iadd__
    fn __iadd__(self, rhs: Int):
        self = self + rhs  # ERROR: cannot assign to self!
```

è¿™é‡Œçš„é—®é¢˜æ˜¯`self`æ˜¯ä¸å¯å˜çš„ï¼Œå› ä¸ºè¿™æ˜¯ä¸€ä¸ªMojo `fn`å‡½æ•°ï¼Œæ‰€ä»¥å®ƒä¸èƒ½æ”¹å˜å®ƒè¢«è°ƒç”¨æ—¶çš„å‚æ•°çš„å†…éƒ¨çŠ¶æ€ã€‚è§£å†³æ–¹æ¡ˆæ˜¯é€šè¿‡åœ¨`self`å‚æ•°åç§°ä¸Šæ·»åŠ `inout`å…³é”®å­—å£°æ˜å‚æ•°æ˜¯å¯å˜çš„ï¼š

```auto
struct Int:
    # ...
    fn __iadd__(inout self, rhs: Int):
        self = self + rhs    # OK
```

**æç¤ºï¼š** å½“ä½ çœ‹åˆ°`inout`æ—¶ï¼Œæ„å‘³ç€å‡½æ•°å†…éƒ¨å¯¹å‚æ•°æ‰€åšçš„ä»»ä½•æ›´æ”¹éƒ½æ˜¯åœ¨å‡½æ•°å¤–å¯è§çš„ã€‚

ç°åœ¨ï¼Œå‡½æ•°ä¸­çš„`self`å‚æ•°æ˜¯å¯å˜çš„ï¼Œå¹¶ä¸”è°ƒç”¨è€…ä¸­çš„ä»»ä½•æ›´æ”¹éƒ½æ˜¯å¯è§çš„â€”â€”å³ä½¿è°ƒç”¨è€…æœ‰ä¸€ä¸ªéå¸¸å¤æ‚çš„è®¡ç®—æ¥è®¿é—®ï¼Œä¾‹å¦‚æ•°ç»„ä¸‹æ ‡

```auto
fn show_mutation():
    var x = 42
    x += 1
    print(x)    # prints 43 of course

    var a = InlinedFixedVector[16, Int](...)
    a[4] = 7
    a[4] += 1    # Mutate an element within the InlinedFixedVector
    print(a[4])  # Prints 8

    let y = x
    y += 1       # ERROR: Cannot mutate 'let' value
```


Mojoå®ç°äº†ä¸Šé¢`InlinedFixedVector`å…ƒç´ çš„åŸåœ°çªå˜ï¼Œé€šè¿‡å°†ä¸€ä¸ªè°ƒç”¨`__getitem__`çš„è°ƒç”¨å‘é€åˆ°ä¸´æ—¶ç¼“å†²åŒºï¼Œç„¶ååœ¨è°ƒç”¨ä¹‹åä½¿ç”¨ `__setitem__` è¿›è¡Œå­˜å‚¨ã€‚å¯¹ `let` å€¼è¿›è¡Œä¿®æ”¹å¤±è´¥ï¼Œå› ä¸ºæ— æ³•å°†ä¸å¯å˜å€¼å½¢æˆå¯å˜å¼•ç”¨ã€‚åŒæ ·ï¼Œå¦‚æœå®ç°äº† `__getitem__` è€Œæ²¡æœ‰å®ç° `__setitem__`ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šæ‹’ç»å°è¯•ä½¿ç”¨å¸¦æœ‰ `inout` å‚æ•°çš„ä¸‹æ ‡æ“ä½œã€‚

å½“ç„¶ï¼Œä½ å¯ä»¥å£°æ˜å¤šä¸ª`inout`å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥å®šä¹‰å¹¶ä½¿ç”¨ä¸€ä¸ªåƒè¿™æ ·çš„swapå‡½æ•°ï¼š

```auto
fn swap(inout lhs: Int, inout rhs: Int):
    let tmp = lhs
    lhs = rhs
    rhs = tmp

fn show_swap():
    var x = 42
    var y = 12
    swap(x, y)
    print(x)  # Prints 12
    print(y)  # Prints 42
```

è¿™ä¸ªç³»ç»Ÿçš„ä¸€ä¸ªéå¸¸é‡è¦çš„æ–¹é¢æ˜¯å®ƒèƒ½å¤Ÿæ­£ç¡®ç»„åˆã€‚

æ³¨æ„ï¼Œæˆ‘ä»¬ä¸æŠŠè¿™ç§å‚æ•°ä¼ é€’ç§°ä¸ºâ€œå¼•ç”¨ä¼ é€’â€ã€‚å°½ç®¡`inout`çº¦å®šåœ¨æ¦‚å¿µä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†æˆ‘ä»¬ä¸ç§°ä¹‹ä¸ºâ€œæŒ‰å¼•ç”¨ä¼ é€’â€ï¼Œå› ä¸ºå®é™…ä¸Šå®ç°å¯èƒ½ä½¿ç”¨æŒ‡é’ˆæ¥ä¼ é€’å€¼ã€‚

## ä¼ é€’å‚æ•°ï¼ˆ`owned` å’Œ `^`ï¼‰


Mojoæ”¯æŒçš„æœ€ç»ˆå‚æ•°çº¦å®šæ˜¯`owned`å‚æ•°çº¦å®šã€‚è¿™ä¸ªçº¦å®šç”¨äºå¸Œæœ›è·å¾—å€¼çš„ç‹¬å æ‰€æœ‰æƒçš„å‡½æ•°ï¼Œé€šå¸¸ä¸åç¼€`^`è¿ç®—ç¬¦ä¸€èµ·ä½¿ç”¨ã€‚


ä¾‹å¦‚ï¼Œæƒ³è±¡ä½ æ­£åœ¨ä½¿ç”¨ä¸€ä¸ªåƒå”¯ä¸€æŒ‡é’ˆè¿™æ ·çš„åªèƒ½ç§»åŠ¨çš„ç±»å‹ã€‚ä½¿ç”¨å€Ÿç”¨çº¦å®šå¯ä»¥è½»æ¾åœ°å¤„ç†ç‹¬ç‰¹çš„æŒ‡é’ˆï¼Œä½†åœ¨æŸäº›æ—¶å€™ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å°†æ‰€æœ‰æƒè½¬ç§»åˆ°å…¶ä»–å‡½æ•°ã€‚è¿™å°±æ˜¯ `^` â€œè½¬ç§»â€æ“ä½œç¬¦çš„ä½œç”¨ï¼š

```auto
fn usePointer():
    let ptr = SomeUniquePtr(...)
    use(ptr)        # Perfectly fine to pass to borrowing function.
    take_ptr(ptr^)  # Pass ownership of the `ptr` value to another function.

    use(ptr) # ERROR: ptr is no longer valid here!
```

å¯¹äºå¯ç§»åŠ¨ç±»å‹ï¼Œ`^`æ“ä½œç¬¦ç»“æŸå€¼ç»‘å®šçš„ç”Ÿå‘½å‘¨æœŸï¼Œå¹¶å°†å€¼æ‰€æœ‰æƒè½¬ç§»åˆ°å…¶ä»–åœ°æ–¹ï¼ˆåœ¨æœ¬ä¾‹ä¸­ï¼Œæ˜¯`take_ptr()` function)ã€‚ä¸ºäº†æ”¯æŒè¿™ä¸€ç‚¹ï¼Œä½ å¯ä»¥å®šä¹‰å‡½æ•°æ¥å—`owned`å‚æ•°ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥è¿™æ ·å®šä¹‰`take_ptr()`ï¼š

```auto
fn take_ptr(owned p: SomeUniquePtr):
    use(p)
```

å› ä¸ºå®ƒè¢«å£°æ˜ä¸º`owned`ï¼Œ`take_ptr()`å‡½æ•°çŸ¥é“å®ƒå¯¹å€¼æœ‰ç‹¬ç‰¹çš„è®¿é—®æƒï¼Œå¹¶å¯ä»¥å®‰å…¨åœ°å°†æŒ‡é’ˆçš„æ‰€æœ‰æƒè¿™å¯¹äºåƒç‹¬ç‰¹æŒ‡é’ˆè¿™æ ·çš„ä¸œè¥¿éå¸¸é‡è¦ï¼Œå½“ä½ æƒ³é¿å…æ‹·è´æ—¶ä¹Ÿå¾ˆæœ‰ç”¨ã€‚


ä¾‹å¦‚ï¼Œæ‚¨ä¼šåœ¨ææ„å‡½æ•°å’Œæ¶ˆè€—ç§»åŠ¨æ„é€ å‡½æ•°ä¸Šæ˜¾ç€çœ‹åˆ°`owned`çº¦å®šã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„`MyString`ç±»å‹å¯ä»¥å¦‚ä¸‹å®šä¹‰ï¼š

```auto
struct MyString:
    var data: Pointer[UI8]

    # StringRef has a data + length field
    def __init__(inout self, input: StringRef): ...
    def __copyinit__(inout self, existing: Self): ...

    def __moveinit__(inout self, owned existing: Self):
        self.data = existing.data

    def __del__(owned self):
        self.data.free()
```

åœ¨`__del__`å‡½æ•°ä¸­æŒ‡å®š`owned`æ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºä½ å¿…é¡»æ‹¥æœ‰ä¸€ä¸ªå€¼æ‰èƒ½é”€æ¯å®ƒã€‚

## æ¯”è¾ƒ`def`å’Œ`fn`å‚æ•°ä¼ é€’

Mojoçš„`def`å‡½æ•°æœ¬è´¨ä¸Šåªæ˜¯ä¸º`fn`å‡½æ•°æä¾›çš„è¯­æ³•ç³–ã€‚

+ ä¸€ä¸ªæ²¡æœ‰æ˜¾å¼ç±»å‹æ³¨é‡Šçš„`def`å‚æ•°é»˜è®¤ä¸º`Object`ã€‚

+ ä¸€ä¸ªæ²¡æœ‰çº¦å®šå…³é”®å­—ï¼ˆä¾‹å¦‚`inout`æˆ–`owned`ï¼‰çš„`def`å‚æ•°å°†é€šè¿‡éšå¼å¤åˆ¶ä¼ å…¥å…·æœ‰ä¸å‚æ•°åŒåçš„å¯å˜varä¸­ã€‚è¿™è¦æ±‚è¯¥ç±»å‹å…·æœ‰ä¸€ä¸ª`__copyinit__`æ–¹æ³•ã€‚


ä¾‹å¦‚ï¼Œè¿™ä¸¤ä¸ªå‡½æ•°å…·æœ‰ç›¸åŒçš„è¡Œä¸ºï¼š

```auto
def example(inout a: Int, b: Int, c):
    # b and c use value semantics so they're mutable in the function
    ...

fn example(inout a: Int, b_in: Int, c_in: Object):
    # b_in and c_in are immutable references, so we make mutable shadow copies
    var b = b_in
    var c = c_in
    ...
```


shadow copiesé€šå¸¸ä¸ä¼šå¢åŠ ä»»ä½•å¼€é”€ï¼Œå› ä¸ºåƒ`Object`è¿™æ ·çš„å°ç±»å‹çš„å¼•ç”¨å¾ˆä¾¿å®œå¯ä»¥å¤åˆ¶ã€‚è°ƒæ•´å¼•ç”¨è®¡æ•°æ˜¯æ˜‚è´µçš„éƒ¨åˆ†ï¼Œä½†é€šè¿‡ç§»åŠ¨ä¼˜åŒ–å¯ä»¥æ¶ˆé™¤è¿™ä¸€éƒ¨åˆ†ã€‚

## Pythoné›†æˆ


ä½¿ç”¨ä½ ç†Ÿæ‚‰å’Œå–œçˆ±çš„Pythonæ¨¡å—åœ¨Mojoä¸­å¾ˆå®¹æ˜“ã€‚ä½ å¯ä»¥å°†ä»»ä½•Pythonæ¨¡å—å¯¼å…¥åˆ°ä½ çš„Mojoç¨‹åºä¸­ï¼Œå¹¶ä»Mojoç±»å‹ä¸­åˆ›å»ºPythonç±»å‹ã€‚

## å¯¼å…¥Pythonæ¨¡å—

åœ¨Mojoä¸­å¯¼å…¥Pythonæ¨¡å—ï¼Œåªéœ€è°ƒç”¨`Python.import_module()`å¹¶ä¼ å…¥æ¨¡å—åç§°å³å¯ï¼š

```auto
from PythonInterface import Python

# This is equivalent to Python's `import numpy as np`
let np = Python.import_module("numpy")

# Now use numpy as if writing in Python
a = np.array([1, 2, 3])
print(a)
```

æ˜¯çš„ï¼Œè¿™å¯¼å…¥äº†Python NumPyï¼Œä½ å¯ä»¥å¯¼å…¥*ä»»ä½•å…¶ä»–çš„Pythonæ¨¡å—*ã€‚

ç›®å‰ï¼Œæ‚¨æ— æ³•å¯¼å…¥å•ä¸ªæˆå‘˜ï¼ˆä¾‹å¦‚å•ä¸ªPythonç±»æˆ–å‡½æ•°ï¼‰-æ‚¨å¿…é¡»å¯¼å…¥æ•´ä¸ªPythonæ¨¡å—ï¼Œç„¶åé€šè¿‡æ¨¡å—åç§°

## å¯¼å…¥æœ¬åœ°Pythonæ¨¡å—

å¦‚æœæ‚¨æƒ³åœ¨Mojoä¸­ä½¿ç”¨æŸäº›æœ¬åœ°Pythonä»£ç ï¼Œåªéœ€å°†è¯¥ç›®å½•æ·»åŠ åˆ°Pythonè·¯å¾„ä¸­ï¼Œç„¶åå¯¼å…¥æ¨¡å—å³å¯ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾ä½ æœ‰ä¸€ä¸ªåƒè¿™æ ·çš„Pythonæ–‡ä»¶ï¼š

```python
import numpy as np

def my_algorithm(a, b):
    array_a = np.random.rand(a, a)
    return array_a + b
```

è¿™æ˜¯ä½ å¦‚ä½•åœ¨Mojoä¸­å¯¼å…¥å’Œä½¿ç”¨å®ƒçš„æ–¹æ³•ï¼š

```auto
from PythonInterface import Python

Python.add_to_path("path/to/module")
let mypython = Python.import_module("mypython")

let c = mypython.my_algorithm(2, 3)
print(c)
```


ä½¿ç”¨Pythonåœ¨Mojoä¸­æ— éœ€æ‹…å¿ƒå†…å­˜ç®¡ç†ã€‚å› ä¸ºMojoä»ä¸€å¼€å§‹å°±æ˜¯ä¸ºPythonè®¾è®¡çš„ï¼Œæ‰€ä»¥ä¸€åˆ‡éƒ½èƒ½æ­£å¸¸è¿è¡Œã€‚

## Pythonä¸­çš„Mojoç±»å‹

MojoåŸå§‹ç±»å‹éšå¼è½¬æ¢ä¸ºPythonå¯¹è±¡ã€‚ä»Šå¤©æˆ‘ä»¬æ”¯æŒåˆ—è¡¨ã€å…ƒç»„ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€å¸ƒå°”å€¼å’Œå­—ç¬¦ä¸²ã€‚

ä¾‹å¦‚ï¼Œç»™å®šä»¥ä¸‹Pythonå‡½æ•°ï¼Œç”¨äºæ‰“å°Pythonç±»å‹ï¼š

```python
def type_printer(my_list, my_tuple, my_int, my_string, my_float):
    print(type(my_list))
    print(type(my_tuple))
    print(type(my_int))
    print(type(my_string))
    print(type(my_float))
```

æ‚¨å¯ä»¥å¯¼å…¥å®ƒå¹¶ä¼ é€’Mojoç±»å‹ï¼Œæ²¡æœ‰é—®é¢˜ã€‚

```auto
from PythonInterface import Python

Python.add_to_path("/path/to/module")
let mypython2 = Python.import_module("mypython2")
mypython2.type_printer([0, 3], (False, True), 4, "orange", 3.4)
```

å®ƒå°†åœ¨éšå¼è½¬æ¢ä¸ºPythonç±»å‹åè¾“å‡ºç±»å‹ï¼š

```python
<class 'list'>
<class 'tuple'>
<class 'int'>
<class 'str'>
<class 'float'>
```


Mojoè¿˜æ²¡æœ‰æ ‡å‡†å­—å…¸ï¼Œå› æ­¤ç›®å‰è¿˜ä¸å¯èƒ½ä»Mojoå­—å…¸ä¸­åˆ›å»ºPythonå­—å…¸ã€‚æ‚¨å¯ä»¥åœ¨Mojoä¸­ä½¿ç”¨Pythonå­—å…¸ï¼è¦åˆ›å»ºä¸€ä¸ªPythonå­—å…¸ï¼Œè¯·ä½¿ç”¨`dict`æ–¹æ³•ï¼š

```auto
from PythonInterface import Python
from PythonObject import PythonObject
from IO import print
from Range import range

def main() -> None:
    let dictionary = Python.dict()
    dictionary["fruit"] = "apple"
    dictionary["starch"] = "potato"
    let keys: PythonObject = ["fruit", "starch", "protein"]
    let N: Int = keys.__len__().to_index()
    print(N, "items")
    for i in range(N):
        if Python.is_type(dictionary.get(keys[i]), Python.none()):
            print(keys[i], "is not in dictionary")
        else:
            print(keys[i], "is included")
```

è¾“å‡ºï¼š

```text
3 items
fruit is included
starch is included
protein is not in dictionary
```

## å‚æ•°åŒ–ï¼šç¼–è¯‘æ—¶å…ƒç¼–ç¨‹


Pythonæœ€ä»¤äººæƒŠå¹çš„ç‰¹æ€§ä¹‹ä¸€å°±æ˜¯å®ƒå¯æ‰©å±•çš„è¿è¡Œæ—¶å…ƒç¼–ç¨‹åŠŸèƒ½ã€‚è¿™ä½¿å¾—å„ç§ç±»å‹çš„åº“å¾—ä»¥å®ç°ï¼Œå¹¶ä¸”æä¾›äº†ä¸€ç§çµæ´»ä¸”å¯æ‰©å±•çš„ç¼–ç¨‹æ¨¡å‹ï¼Œè®©å…¨ä¸–ç•Œçš„Pythonç¨‹åºå‘˜å¯ä»¥ä»ä¸­å—ç›Šã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™äº›åŠŸèƒ½ä¹Ÿæ˜¯æœ‰ä»£ä»·çš„ï¼šå› ä¸ºå®ƒä»¬æ˜¯åœ¨è¿è¡Œæ—¶è¯„ä¼°çš„ï¼Œå®ƒä»¬ç›´æ¥å½±å“åº•å±‚ä»£ç çš„è¿è¡Œæ—¶æ•ˆç‡ã€‚ç”±äºå®ƒä»¬å¯¹IDEä¸ç†Ÿæ‚‰ï¼Œå› æ­¤IDEåŠŸèƒ½ï¼ˆå¦‚ä»£ç è¡¥å…¨ï¼‰å¾ˆéš¾ç†è§£å®ƒä»¬ï¼Œä»è€Œæ— æ³•æ”¹å–„å¼€å‘è€…çš„ä½“éªŒã€‚


åœ¨Pythonç”Ÿæ€ç³»ç»Ÿä¹‹å¤–ï¼Œé™æ€å…ƒç¼–ç¨‹ä¹Ÿæ˜¯å¼€å‘çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå®ƒä½¿å¾—å¼€å‘æ–°çš„ç¼–ç¨‹èŒƒå¼å’Œå…ˆè¿›çš„åº“æˆä¸ºå¯èƒ½ã€‚åœ¨è¿™ä¸ªé¢†åŸŸæœ‰è®¸å¤šå…ˆå‰æŠ€æœ¯çš„ä¾‹å­ï¼Œæœ‰ä¸åŒçš„æƒè¡¡ï¼Œä¾‹å¦‚ï¼š

1. é¢„å¤„ç†å™¨ï¼ˆä¾‹å¦‚Sassï¼‰C é¢„å¤„ç†å™¨ã€Lex/YACC ç­‰å¯èƒ½æ˜¯æœ€é‡é‡çº§çš„å®ƒä»¬æ˜¯å®Œå…¨é€šç”¨çš„ï¼Œä½†åœ¨å¼€å‘äººå‘˜ä½“éªŒå’Œå·¥å…·é›†æˆæ–¹é¢è¡¨ç°æœ€å·®ã€‚
1. ä¸€äº›è¯­è¨€ï¼ˆå¦‚Lispå’ŒRustï¼‰æ”¯æŒï¼ˆæœ‰æ—¶ç§°ä¸ºâ€œå«ç”Ÿâ€ï¼‰å®å±•å¼€åŠŸèƒ½ï¼Œå¯ä»¥å®ç°è¯­æ³•æ‰©å±•å’Œé™ä½æ ·æ¿ä»£ç ï¼Œä¸”å…·å¤‡æ›´å¥½çš„å·¥å…·é›†æˆã€‚
1. ä¸€äº›è¾ƒè€çš„è¯­è¨€ï¼Œå¦‚C++ï¼Œå…·æœ‰éå¸¸å¤§ä¸”å¤æ‚çš„å…ƒç¼–ç¨‹è¯­è¨€ï¼ˆæ¨¡æ¿ï¼‰ï¼Œå®ƒä»¬æ˜¯è¿è¡Œæ—¶è¯­è¨€çš„å¯¹ç­‰ç‰©ã€‚è¿™äº›æ˜¾ç„¶å¾ˆéš¾å­¦ä¹ ï¼Œç¼–è¯‘æ—¶é—´å¾ˆé•¿ï¼Œè€Œä¸”é”™è¯¯ä¿¡æ¯ä¸å‹å¥½ã€‚
1. ä¸€äº›è¯­è¨€ï¼ˆå¦‚Swiftï¼‰ä»¥ä¸€æµçš„æ–¹å¼å°†è®¸å¤šåŠŸèƒ½æ„å»ºåˆ°æ ¸å¿ƒè¯­è¨€ä¸­ï¼Œä»¥ä¾¿ä¸ºå¸¸è§æƒ…å†µæä¾›è‰¯å¥½çš„äººæœºäº¤äº’ï¼Œï¼Œä½†å¯èƒ½ä»¥ç‰ºç‰²ä¸€èˆ¬æ€§ä¸ºä»£ä»·ã€‚
1. ä½†ä¸€äº›åƒZigè¿™æ ·çš„æ–°è¯­è¨€å°†è¯­è¨€è§£é‡Šå™¨é›†æˆåˆ°ç¼–è¯‘æµç¨‹ä¸­ï¼Œå¹¶å…è®¸è§£é‡Šå™¨åœ¨ç¼–è¯‘æ—¶åæ˜ æŠ½è±¡è¯­æ³•æ ‘ã€‚è¿™å…è®¸å…·æœ‰æ›´å¥½çš„å¯æ‰©å±•æ€§å’Œæ™®éæ€§çš„å®ç³»ç»Ÿå…·æœ‰è®¸å¤šç›¸åŒçš„åŠŸèƒ½ã€‚

æˆ‘ä»¬éœ€è¦å…ˆè¿›çš„å…ƒç¼–ç¨‹ç³»ç»Ÿæä¾›çš„é«˜æŠ½è±¡èƒ½åŠ›æ¥å®ŒæˆModularåœ¨AIã€é«˜æ€§èƒ½æœºå™¨å­¦ä¹ å†…æ ¸å’ŒåŠ é€Ÿå™¨æ–¹é¢çš„å·¥ä½œã€‚æˆ‘ä»¬éœ€è¦é«˜çº§é›¶æˆæœ¬æŠ½è±¡ã€å¯Œæœ‰è¡¨ç°åŠ›çš„åº“ä»¥åŠå¤§è§„æ¨¡é›†æˆå¤šç§ç®—æ³•ã€‚æˆ‘ä»¬å¸Œæœ›å›¾ä¹¦é¦†å¼€å‘äººå‘˜èƒ½å¤Ÿåƒåœ¨Pythonä¸­é‚£æ ·æ‰©å±•ç³»ç»Ÿï¼Œæä¾›å¯æ‰©å±•çš„å¼€å‘å¹³å°ã€‚

ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬ä¸æ„¿ç‰ºç‰²å¼€å‘äººå‘˜çš„ä½“éªŒï¼ˆåŒ…æ‹¬ç¼–è¯‘æ—¶é—´å’Œé”™è¯¯æ¶ˆæ¯ï¼‰ï¼Œä¹Ÿä¸æ„¿æ„å»ºç«‹ä¸€ä¸ªéš¾ä»¥æ•™æˆæˆ‘ä»¬å¯ä»¥ä»è¿™äº›ä»¥å‰çš„ç³»ç»Ÿä¸­å­¦ä¹ ï¼Œä½†ä¹Ÿå¯ä»¥åˆ©ç”¨æ–°æŠ€æœ¯æ¥æ„å»ºï¼ŒåŒ…æ‹¬MLIRå’Œç»†ç²’åº¦çš„è¯­è¨€é›†æˆç¼“å­˜æŠ€æœ¯ã€‚


å› æ­¤ï¼ŒMojoæ”¯æŒå°†ç¼–è¯‘æ—¶å…ƒç¼–ç¨‹ä½œä¸ºç¼–è¯‘çš„å•ç‹¬é˜¶æ®µæ„å»ºåˆ°ç¼–è¯‘å™¨ä¸­ï¼Œåœ¨è§£æã€è¯­ä¹‰åˆ†æå’ŒIRç”Ÿæˆä¹‹åå®ƒä½¿ç”¨ç›¸åŒçš„ä¸»æœºè¯­è¨€æ¥è¿è¡Œæ—¶ç¨‹åºï¼Œä¹Ÿç”¨äºå…ƒç¨‹åºï¼Œå¹¶åˆ©ç”¨MLIRæ¥è¡¨ç¤ºå’Œè¯„ä¼°è¿™äº›ç¨‹åºã€‚

è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸€äº›ç®€å•çš„ä¾‹å­ã€‚

**å…³äºâ€œå‚æ•°â€ï¼š**Pythonå¼€å‘è€…é€šå¸¸ä¼šå°†â€œargumentsâ€å’Œâ€œparametersâ€è¿™ä¸¤ä¸ªè¯åœ¨â€œä¼ é€’ç»™å‡½æ•°çš„ä¸œè¥¿â€æ–¹é¢ç›¸å½“äº’æ¢ä½¿ç”¨ã€‚æˆ‘ä»¬å†³å®šåœ¨Mojoä¸­é‡æ–°ä½¿ç”¨â€œparameterâ€å’Œâ€œparameter expressionâ€æ¥è¡¨ç¤ºç¼–è¯‘æ—¶çš„å€¼ï¼Œå¹¶ç»§ç»­ä½¿ç”¨â€œargumentâ€å’Œâ€œexpressionâ€æ¥æŒ‡ä»£è¿è¡Œæ—¶çš„å€¼ã€‚æˆ‘ä»¬å†³å®šè¿™ä½¿æˆ‘ä»¬èƒ½å¤Ÿå›´ç»•åƒâ€œparameterizedâ€å’Œâ€œparametricâ€è¿™æ ·çš„è¯è¿›è¡Œç¼–è¯‘æ—¶å…ƒç¼–ç¨‹ã€‚

## å®šä¹‰å‚æ•°åŒ–ç±»å‹å’Œå‡½æ•°

ä½ å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­æŒ‡å®šå‚æ•°åç§°å’Œç±»å‹ï¼ˆä½¿ç”¨[PEP695è¯­æ³•](https://peps.python.org/pep-0695/)çš„æ‰©å±•ç‰ˆæœ¬ï¼‰æ¥å‚æ•°åŒ–ç»“æ„å‚æ•°å€¼ä¸å‚æ•°å€¼ä¸åŒï¼Œå‚æ•°å€¼åœ¨ç¼–è¯‘æ—¶å·²çŸ¥ï¼Œè¿™ä½¿å¾—å¯ä»¥å®ç°æ›´é«˜çº§åˆ«çš„æŠ½è±¡å’Œä»£ç é‡ç”¨ï¼Œä»¥åŠç¼–è¯‘å™¨çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚è‡ªåŠ¨è°ƒä¼˜ï¼ˆautotuningï¼‰ç­‰ã€‚


ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹[SIMD](https://en.wikipedia.org/wiki/Single_instruction,_multiple_data)ç±»å‹ï¼Œå®ƒä»£è¡¨ç¡¬ä»¶ä¸­çš„ä½çº§çŸ¢é‡å¯„å­˜å™¨ï¼Œèƒ½å¤Ÿå­˜å‚¨å¤šä¸ªæ ‡é‡æ•°æ®ç±»å‹çš„å®ä¾‹ã€‚ç¡¬ä»¶åŠ é€Ÿå™¨ä¸æ–­å¼•å…¥æ–°çš„çŸ¢é‡æ•°æ®ç±»å‹ï¼Œç”šè‡³CPUå¯èƒ½å…·æœ‰512ä½æˆ–æ›´é•¿çš„SIMDçŸ¢é‡ã€‚ä¸ºäº†è®¿é—®è¿™äº›å¤„ç†å™¨ä¸Šçš„SIMDæŒ‡ä»¤ï¼Œæ•°æ®å¿…é¡»æŒ‰ç…§æ­£ç¡®çš„SIMDå®½åº¦ï¼ˆæ•°æ®ç±»å‹ï¼‰å’Œé•¿åº¦ï¼ˆå‘é‡å¤§å°ï¼‰ã€‚


ä½†æ˜¯ï¼Œç”¨Mojoå†…ç½®çš„ç±»å‹æ¥å®šä¹‰æ‰€æœ‰ä¸åŒçš„SIMDå˜ä½“æ˜¯ä¸å¯è¡Œçš„ã€‚å› æ­¤ï¼ŒMojoçš„`SIMD`ç±»å‹ï¼ˆå®šä¹‰ä¸ºç»“æ„ï¼‰åœ¨å…¶æ–¹æ³•ä¸­æš´éœ²äº†å¸¸è§çš„SIMDæ“ä½œï¼Œå¹¶ä½¿SIMDæ•°æ®ç±»å‹å’Œå¤§å°å€¼å‚è¿™å…è®¸æ‚¨ç›´æ¥å°†æ•°æ®æ˜ å°„åˆ°ä»»ä½•ç¡¬ä»¶ä¸Šçš„SIMDå‘é‡ã€‚ä»¥ä¸‹æ˜¯Mojoçš„`SIMD`ç±»å‹çš„ç®€åŒ–ç‰ˆæœ¬ï¼š

```auto
struct SIMD[type: DType, size: Int]:
    var value: â€¦ # Some low-level MLIR stuff here

    # Create a new SIMD from a number of scalars
    fn __init__(inout self, *elems: SIMD[type, 1]):  ...

    # Fill a SIMD with a duplicated scalar value.
    @staticmethod
    fn splat(x: SIMD[type, 1]) -> SIMD[type, size]: ...

    # Cast the elements of the SIMD to a different elt type.
    fn cast[target: DType](self) -> SIMD[target, size]: ...

    # Many standard operators are supported.
    fn __add__(self, rhs: Self) -> Self: ...
```

ä½¿ç”¨å‚æ•°å®šä¹‰æ¯ä¸ªSIMDå˜ä½“å¯¹äºä»£ç é‡ç”¨éå¸¸æœ‰ç”¨ï¼Œå› ä¸º`SIMD`ç±»å‹å¯ä»¥é™æ€åœ°è¡¨è¾¾æ‰€æœ‰ä¸åŒçš„å‘é‡å˜ä½“ï¼Œè€Œä¸è¦æ±‚è¯­è¨€é¢„å®šä¹‰æ¯ä¸ªå˜ä½“

å› ä¸º`SIMD`æ˜¯ä¸€ç§å‚æ•°åŒ–ç±»å‹ï¼Œå®ƒçš„å‡½æ•°ä¸­çš„`self`å‚æ•°æºå¸¦äº†è¿™äº›å‚æ•°â€”â€”å®Œæ•´çš„ç±»å‹åç§°æ˜¯`SIMD[type, size]`ã€‚è™½ç„¶ç”¨è¿™ç§æ–¹å¼å†™å‡ºæ¥ï¼ˆå¦‚`splat()`çš„è¿”å›ç±»å‹æ‰€ç¤ºï¼‰æ˜¯æœ‰æ•ˆçš„ï¼Œä½†æ˜¯è¿™æ ·ä¼šæ˜¾å¾—å†—é•¿ï¼Œå› æ­¤æˆ‘ä»¬å»ºè®®ä½¿ç”¨`Self`ç±»å‹ï¼ˆæ¥è‡ªPEP673ï¼‰æ¥å®ç°ç±»ä¼¼`__add__`ç¤ºä¾‹çš„åŠŸèƒ½ã€‚

## å‚æ•°é‡è½½


å‡½æ•°å’Œæ–¹æ³•å¯ä»¥æ ¹æ®å‚æ•°ç­¾åè¿›è¡Œé‡è½½ã€‚æ ¹æ®ä»¥ä¸‹è§„åˆ™ï¼ŒæŒ‰ä¼˜å…ˆçº§é¡ºåºè¿‡æ»¤å€™é€‰é¡¹ï¼š

1. å€™é€‰äººå…·æœ‰æœ€å°‘çš„éšå¼è½¬æ¢ï¼ˆåœ¨å‚æ•°å’Œå‚æ•°ä¸­ï¼‰ã€‚
1. å€™é€‰è€…æ²¡æœ‰å¯å˜å‚æ•°ã€‚
1. å€™é€‰è€…æ²¡æœ‰å¯å˜å‚æ•°ã€‚
1. å€™é€‰äººå‚æ•°ç­¾åæœ€çŸ­ã€‚


å¦‚æœåœ¨åº”ç”¨è¿™äº›è§„åˆ™åæœ‰å¤šä¸ªå€™é€‰è€…ï¼Œé‚£ä¹ˆè¶…è½½è§£æå°±ä¼šå¤±è´¥ã€‚ä¾‹å¦‚ï¼š

```auto
@register_passable("trivial")
struct MyInt:
    """A type that is implicitly convertible to `Int`."""
    var value: Int

    @always_inline("nodebug")
    fn __init__(_a: Int) -> Self:
        return Self {value: _a}

fn foo[x: MyInt, a: Int](): pass

fn foo[x: MyInt, y: MyInt](): pass

fn bar[a: Int](b: Int): pass

fn bar[a: Int](*b: Int): pass

fn bar[*a: Int](b: Int): pass

fn waldo[a: Int](b: Int): pass

fn waldo[a: Int, T: AnyType](y: T): pass

fn parameterOverloads[a: Int, b: Int, x: MyInt]():
    # `foo[x: MyInt, a: Int]()` is called because it requires no implicit
    # conversions, whereas `foo[x: MyInt, y: MyInt]()` requires one.
    foo[x, a]()

    # `bar[x: Int](y: Int)` is called because it does not have variadic
    # arguments or parameters.
    bar[a](b)

    # `waldo[x: Int](y: Int)` is called because it has a shorter parameter
    # signature than `waldo[x: Int, T: AnyType](y: T)`.
    waldo[a](b)
```

## ä½¿ç”¨å‚æ•°åŒ–ç±»å‹å’Œå‡½æ•°

å¯ä»¥é€šè¿‡åœ¨æ–¹æ‹¬å·ä¸­ä¼ é€’å€¼æ¥å®ä¾‹åŒ–å‚æ•°ç±»å‹å’Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸Šé¢çš„`SIMD`ç±»å‹ï¼Œ`type`æŒ‡å®šæ•°æ®ç±»å‹ï¼Œ`size`æŒ‡å®šSIMDå‘é‡çš„é•¿åº¦ï¼ˆå¿…é¡»æ˜¯2çš„å¹‚ï¼‰ï¼š

```auto
fn funWithSIMD():
    # Make a vector of 4 floats.
    let small_vec = SIMD[DType.float32, 4](1.0, 2.0, 3.0, 4.0)

    # Make a big vector containing 1.0 in float16 format.
    let big_vec = SIMD[DType.float16, 32].splat(1.0)

    # Do some math and convert the elements to float32.
    let bigger_vec = (big_vec+big_vec).cast[DType.float32]()

    # You can write types out explicitly if you want of course.
    let bigger_vec2 : SIMD[DType.float32, 32] = bigger_vec
```

æ³¨æ„ï¼Œ`cast()`æ–¹æ³•è¿˜éœ€è¦ä¸€ä¸ªå‚æ•°æ¥æŒ‡å®šä½ æƒ³è¦çš„ç±»å‹ï¼ˆä¸Šé¢çš„æ–¹æ³•å®šä¹‰æœŸæœ›ä¸€ä¸ª`target`å‚æ•°å€¼ï¼‰å› æ­¤ï¼Œå°±åƒ`SIMD`ç»“æ„æ˜¯ä¸€ä¸ªé€šç”¨ç±»å‹å®šä¹‰ä¸€æ ·ï¼Œ`cast()`æ–¹æ³•æ˜¯ä¸€ä¸ªæ³›å‹æ–¹æ³•å®šä¹‰ï¼Œæ ¹æ®å‚æ•°å€¼åœ¨ç¼–è¯‘æ—¶è€Œä¸æ˜¯è¿è¡Œæ—¶è¢«å®ä¾‹åŒ–ã€‚

ä¸Šé¢çš„`funWithSIMD()`å‡½æ•°å±•ç¤ºäº†å…·ä½“ç±»å‹çš„ä½¿ç”¨ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä½¿ç”¨å·²çŸ¥çš„ç±»å‹å€¼å®ä¾‹åŒ–`SIMD`ï¼‰ï¼Œä½†å‚æ•°çš„ä¸»è¦ä¼˜åŠ¿æ¥è‡ªäºå®šä¹‰å‚æ•°åŒ–ç®—æ³•å’Œç±»å‹(ä½¿ç”¨å‚æ•°å€¼çš„ä»£ç ï¼‰çš„èƒ½åŠ›ã€‚ä¾‹å¦‚ï¼Œè¿™æ˜¯å¦‚ä½•å®šä¹‰ä¸€ä¸ªå…·æœ‰`SIMD`çš„å‚æ•°åŒ–ç®—æ³•ï¼Œå®ƒæ—¢å…·æœ‰ç±»å‹åˆå…·æœ‰å®½åº¦çš„ä¸å˜æ€§ï¼š

```auto
fn rsqrt[dt: DType, width: Int](x: SIMD[dt, width]) -> SIMD[dt, width]:
    return 1 / sqrt(x)
```


æ³¨æ„`x`å‚æ•°å®é™…ä¸Šæ˜¯åŸºäºå‡½æ•°å‚æ•°çš„`SIMD`ç±»å‹ã€‚è¿è¡Œæ—¶ç¨‹åºå¯ä»¥ä½¿ç”¨å‚æ•°çš„å€¼ï¼Œå› ä¸ºåœ¨è¿è¡Œæ—¶ç¨‹åºéœ€è¦å‚æ•°ä¹‹å‰ï¼Œå‚æ•°ä¼šåœ¨ç¼–è¯‘æ—¶è¢«è§£æï¼ˆä½†ç¼–è¯‘æ—¶å‚æ•°è¡¨è¾¾å¼æ— æ³•ä½¿ç”¨è¿è¡Œæ—¶çš„å€¼ï¼‰ã€‚


Mojoç¼–è¯‘å™¨åœ¨å‚æ•°ç±»å‹æ¨æ–­æ–¹é¢ä¹Ÿå¾ˆèªæ˜ã€‚æ³¨æ„ï¼Œä¸Šè¿°å‡½æ•°èƒ½å¤Ÿè°ƒç”¨å‚æ•°[`sqrt()`](https://docs.modular.com/mojo/MojoStdlib/Math.html#sqrt)å‡½æ•°ï¼Œè€Œæ— éœ€æŒ‡å®šå‚æ•°â€”â€”ç¼–è¯‘å™¨æ¨æ–­å‚æ•°çš„æ–¹å¼å°±å¥½åƒä½ æ˜ç¡®åœ°å†™å‡ºäº† `sqrt[type, simd_width](x)` ä¸€æ ·ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œ`rsqrt()`é€‰æ‹©å®šä¹‰å…¶ç¬¬ä¸€ä¸ªå‚æ•°åä¸º`width`ï¼Œå³ä½¿`SIMD`ç±»å‹å°†å…¶å‘½åä¸º`size`ï¼Œä¹Ÿæ²¡æœ‰é—®é¢˜ã€‚

## å‚æ•°è¡¨è¾¾å¼åªæ˜¯Mojoä»£ç ã€‚


å‚æ•°è¡¨è¾¾å¼æ˜¯ä»»ä½•åœ¨é¢„æœŸå‚æ•°å¤„å‡ºç°çš„ä»£ç è¡¨è¾¾å¼ï¼ˆå¦‚`a+b`ï¼‰ã€‚å‚æ•°è¡¨è¾¾å¼æ”¯æŒæ“ä½œç¬¦å’Œå‡½æ•°è°ƒç”¨ï¼Œå°±åƒè¿è¡Œæ—¶ä»£ç ä¸€æ ·ï¼Œæ‰€æœ‰å‚æ•°ç±»å‹ä½¿ç”¨ä¸è¿è¡Œæ—¶ç¨‹åºç›¸åŒçš„ç±» (such as `Int` and `DType`)

å› ä¸ºå‚æ•°è¡¨è¾¾å¼ä½¿ç”¨ä¸è¿è¡Œæ—¶Mojoä»£ç ç›¸åŒçš„è¯­æ³•å’Œç±»å‹ï¼Œæ‰€ä»¥æ‚¨å¯ä»¥ä½¿ç”¨è¯­è¨€çš„è®¸å¤šâ€œä¾èµ–ç±»å‹â€ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›å®šä¹‰ä¸€ä¸ªè¾…åŠ©å‡½æ•°æ¥è¿æ¥ä¸¤ä¸ªSIMDå‘é‡ï¼š

```auto
fn concat[ty: DType, len1: Int, len2: Int](
    lhs: SIMD[ty, len1], rhs: SIMD[ty, len2]) -> SIMD[ty, len1+len2]:
      ...

fn use_vectors(a: SIMD[DType.float32, 4], b: SIMD[DType.float16, 8]):
    let x = concat(a, a)  # Length = 8
    let y = concat(b, b)  # Length = 16
```


æ³¨æ„ï¼Œç»“æœé•¿åº¦æ˜¯è¾“å…¥å‘é‡é•¿åº¦çš„æ€»å’Œï¼Œå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„`+`æ“ä½œæ¥è¡¨è¾¾ã€‚ä¾‹å¦‚ï¼Œè¯·çœ‹æ ‡å‡†åº“ä¸­çš„[`SIMD.shuffle()`](https://docs.modular.com/mojo/MojoStdlib/SIMD.html#shuffle)æ–¹æ³•ï¼šå®ƒæ¥å—ä¸¤ä¸ªè¾“å…¥SIMDå€¼ï¼Œä¸€ä¸ªå‘é‡æ··æ´—æ©ç ä½œä¸ºåˆ—è¡¨ï¼Œå¹¶è¿”å›ä¸€ä¸ªä¸æ··æ´—æ©ç é•¿åº¦ç›¸åŒ¹é…çš„SIMDç»“æœã€‚

## å¼ºå¤§çš„ç¼–è¯‘æ—¶ç¼–ç¨‹


æœ‰æ—¶å€™ï¼Œå½“éœ€è¦ç¼–å†™å…·æœ‰æ§åˆ¶æµçš„ç¼–è¯‘æ—¶é€»è¾‘æ—¶ï¼Œç®€å•çš„è¡¨è¾¾å¼å°±æ˜¾å¾—ä¸å¤Ÿç”¨äº†ã€‚ä¾‹å¦‚ï¼ŒMojo `Math` æ¨¡å—ä¸­çš„ `isclose()` å‡½æ•°å¯¹æ•´æ•°ä½¿ç”¨ç²¾ç¡®ç›¸ç­‰ï¼Œè€Œå¯¹æµ®ç‚¹æ•°ä½¿ç”¨â€œæ¥è¿‘â€æ¯”è¾ƒã€‚ä½ ç”šè‡³å¯ä»¥è¿›è¡Œç¼–è¯‘æ—¶é€’å½’ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªâ€œæ ‘å½¢å‡å°‘â€ç®—æ³•çš„ä¾‹å­ï¼Œå®ƒå¯ä»¥é€’å½’åœ°å°†å‘é‡ä¸­çš„æ‰€æœ‰å…ƒç´ æ±‚å’Œä¸ºæ ‡é‡ï¼š

```auto
struct SIMD[type: DType, size: Int]:
    ...
    fn reduce_add(self) -> SIMD[type, 1]:
        @parameter
        if size == 1:
            return self[0]
        elif size == 2:
            return self[0] + self[1]

        # Extract the top/bottom halves, add them, sum the elements.
        let lhs = self.slice[size // 2](0)
        let rhs = self.slice[size // 2](size // 2)
        return (lhs + rhs).reduce_add()
```


è¿™ä½¿ç”¨äº†`@parameter if`åŠŸèƒ½ï¼Œå®ƒæ˜¯ä¸€ä¸ªåœ¨ç¼–è¯‘æ—¶è¿è¡Œçš„`if`è¯­å¥ã€‚å®ƒè¦æ±‚å…¶æ¡ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„å‚æ•°è¡¨è¾¾å¼ï¼Œå¹¶ç¡®ä¿åªæœ‰`if`è¯­å¥çš„æ´»åŠ¨åˆ†æ”¯æ‰èƒ½è¢«ç¼–è¯‘åˆ°ç¨‹åºä¸­ã€‚

## Mojoç±»å‹åªæ˜¯å‚æ•°è¡¨è¾¾å¼

è€Œæˆ‘ä»¬å·²ç»å±•ç¤ºäº†å¦‚ä½•åœ¨ç±»å‹ä¸­ä½¿ç”¨å‚æ•°è¡¨è¾¾å¼ï¼Œç±»å‹æ³¨é‡Šæœ¬èº«å¯ä»¥æ˜¯ä»»æ„è¡¨è¾¾å¼ï¼ˆå°±åƒåœ¨Pythonä¸­ä¸€æ ·ï¼‰ã€‚Mojoä¸­çš„ç±»å‹å…·æœ‰ä¸€ç§ç‰¹æ®Šçš„å…ƒç±»å‹ï¼Œå…è®¸å®šä¹‰ç±»å‹å‚æ•°åŒ–çš„ç®—æ³•å’Œå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œä½ å¯ä»¥åƒè¿™æ ·å®šä¹‰ä¸€ä¸ªç±»ä¼¼C++ `std::vector` çš„ç®—æ³•ï¼š

```auto
struct DynamicVector[type: AnyType]:
    ...
    fn reserve(inout self, new_capacity: Int): ...
    fn push_back(inout self, value: type): ...
    fn pop_back(inout self): ...
    fn __getitem__(self, i: Int) -> type: ...
    fn __setitem__(inout self, i: Int, value: type): ...

fn use_vector():
    var v = DynamicVector[Int]()
    v.push_back(17)
    v.push_back(42)
    v[0] = 123
    print(v[1])      # Prints 42
    print(v[0])      # Prints 123
```


æ³¨æ„`type`å‚æ•°è¢«ç”¨ä½œ`value`å‚æ•°çš„æ­£å¼ç±»å‹ï¼Œä»¥åŠ`__getitem__`å‡½æ•°çš„è¿”å›ç±»å‹ã€‚å‚æ•°å…è®¸`DynamicVector`ç±»å‹æ ¹æ®ä¸åŒçš„ç”¨ä¾‹æä¾›ä¸åŒçš„APIã€‚æœ‰è®¸å¤šå…¶ä»–æƒ…å†µå¯ä»¥ä»æ›´é«˜çº§çš„ç”¨ä¾‹ä¸­å—ç›Šã€‚ä¾‹å¦‚ï¼Œå¹¶è¡Œå¤„ç†åº“å®šä¹‰äº†`parallel`ç®—æ³•ï¼Œè¯¥ç®—æ³•å¹¶è¡Œæ‰§è¡Œé—­åŒ…Næ¬¡ï¼Œæ¯æ¬¡ä»ä¸Šä¸‹æ–‡ä¸­è¾“å…¥ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å¯¹è±¡ç”šè‡³æ˜¯å‡½æ•°ã€‚

```auto
fn parallelize[
    arg_type: AnyType,
    func: fn(Int, arg_type) -> None,
](rt: Runtime, num_work_items: Int, arg: arg_type):
    # Not actually parallel: see Functional.mojo for real impl.
    for i in range(num_work_items):
        func(i, arg)
```

å› ä¸º`func`å‚æ•°å…è®¸å¼•ç”¨å…ˆå‰çš„`arg_type`å‚æ•°ï¼Œè€Œä¸”å¯ä»¥ç»†åŒ–å®ƒçš„ç±»å‹ï¼Œæ‰€ä»¥è¿™æ˜¯å¯èƒ½çš„ã€‚

å¦ä¸€ä¸ªé‡è¦çš„ä¾‹å­æ˜¯å˜å‚æ³›å‹ï¼Œåœ¨è¿™é‡Œï¼Œä¸€ä¸ªç®—æ³•æˆ–æ•°æ®ç»“æ„å¯èƒ½éœ€è¦åœ¨ä¸€ç»„å¼‚æ„ç±»å‹ä¸Šå®šä¹‰ï¼š

```auto
struct Tuple[*ElementTys: AnyType]:
    var _storage : *ElementTys
```

æ³¨æ„ï¼šæˆ‘ä»¬è¿˜æ²¡æœ‰è¶³å¤Ÿçš„å…ƒç±»å‹å¸®åŠ©ç¨‹åºï¼Œä½†æˆ‘ä»¬å°†æ¥åº”è¯¥å¯ä»¥ç¼–å†™ç±»ä¼¼çš„ä¸œè¥¿ï¼Œå°½ç®¡é‡è½½ä»ç„¶æ˜¯å¤„ç†è¿™äº›æ›´å¥½çš„æ–¹æ³•

```auto
struct Array[T: AnyType]:
    fn __getitem__[IndexType: AnyType](self, idx: IndexType)
       -> (ArraySlice[T] if issubclass(IndexType, Range) else T):
       ...
```

## `åˆ«å`ï¼šå‘½åå‚æ•°è¡¨è¾¾å¼

æƒ³è¦ç¼–è¯‘æ—¶å€™çš„å€¼å¾—å‘½åæ˜¯å¾ˆå¸¸è§çš„ã€‚è€Œ`var`å®šä¹‰äº†ä¸€ä¸ªè¿è¡Œæ—¶çš„å€¼ï¼Œ`let`å®šä¹‰äº†ä¸€ä¸ªè¿è¡Œæ—¶çš„å¸¸é‡ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥å®šä¹‰ä¸€ä¸ªç¼–è¯‘æ—¶çš„ä¸´æ—¶å€¼ã€‚Mojoä½¿ç”¨`alias`å£°æ˜æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä¾‹å¦‚ï¼Œ`DType` ç»“æ„ä½“ä½¿ç”¨åˆ«åä¸ºæšä¸¾å™¨å®ç°äº†ä¸€ä¸ªç®€å•çš„æšä¸¾ï¼Œå°±åƒè¿™æ ·ï¼ˆå®é™…çš„å†…éƒ¨å®ç°ç»†èŠ‚å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼‰ã€‚

```auto
struct DType:
    var value : UI8
    alias invalid = DType(0)
    alias bool = DType(1)
    alias int8 = DType(2)
    alias uint8 = DType(3)
    alias int16 = DType(4)
    alias int16 = DType(5)
    ...
    alias float32 = DType(15)
```


è¿™å…è®¸å®¢æˆ·ç«¯è‡ªç„¶åœ°å°†`DType.float32`ç”¨ä½œå‚æ•°è¡¨è¾¾å¼ï¼ˆä¹Ÿå¯ä»¥ç”¨ä½œè¿è¡Œæ—¶å€¼ï¼‰ã€‚æ³¨æ„ï¼Œè¿™æ˜¯åœ¨ç¼–è¯‘æ—¶è°ƒç”¨`DType`çš„è¿è¡Œæ—¶æ„é€ å‡½æ•°ã€‚

åˆ«åè¿˜å¯ä»¥ç”¨äºç±»å‹ï¼šç”±äºç±»å‹æ˜¯ç¼–è¯‘æ—¶è¡¨è¾¾å¼ï¼Œå› æ­¤å¯ä»¥æ–¹ä¾¿åœ°åšä¸€äº›äº‹æƒ…ï¼Œå¦‚ï¼š

```auto
alias Float32 = SIMD[DType.float32, 1]
alias UInt8 = SIMD[DType.uint8, 1]

var x : Float32   # Float32 works like a "typedef"
```

åƒ`var`å’Œ`let`ä¸€æ ·ï¼Œåˆ«åä¹Ÿéµå®ˆä½œç”¨åŸŸï¼Œæ‚¨å¯ä»¥åƒé¢„æœŸçš„é‚£æ ·åœ¨å‡½æ•°ä¸­ä½¿ç”¨å±€éƒ¨åˆ«åã€‚

é¡ºä¾¿è¯´ä¸€å¥ï¼Œ`None` å’Œ `AnyType` éƒ½è¢«å®šä¹‰ä¸º[ç±»å‹åˆ«å](https://docs.modular.com/mojo/MojoBuiltin/TypeAliases.html)ã€‚

## è‡ªé€‚åº”ç¼–è¯‘/è‡ªåŠ¨è°ƒèŠ‚


Mojoå‚æ•°è¡¨è¾¾å¼å…è®¸æ‚¨ç¼–å†™å¯ç§»æ¤çš„å‚æ•°ç®—æ³•ï¼Œå°±åƒæ‚¨åœ¨å…¶ä»–è¯­è¨€ä¸­æ‰€åšçš„é‚£æ ·ï¼Œä½†æ˜¯ï¼Œåœ¨ç¼–å†™é«˜æ€§èƒ½ä»£ç æ—¶ï¼Œä½ ä»ç„¶éœ€è¦é€‰æ‹©å…·ä½“çš„å‚æ•°å€¼æ¥ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œåœ¨ç¼–å†™é«˜æ€§èƒ½æ•°å€¼ç®—æ³•æ—¶ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä½¿ç”¨å†…å­˜åˆ†å—æ¥åŠ é€Ÿç®—æ³•ï¼Œä½†è¦ä½¿ç”¨çš„ç»´åº¦é«˜åº¦ä¾èµ–äºå¯ç”¨çš„ç¡¬ä»¶åŠŸèƒ½ã€ç¼“å­˜å¤§å°ã€èåˆåˆ°å†…æ ¸ä¸­çš„å†…å®¹ä»¥åŠè®¸å¤šå…¶ä»–å¾®å¦™çš„ç»†èŠ‚ã€‚


ç”±äºå…¸å‹æœºå™¨çš„å‘é‡é•¿åº¦å–å†³äºæ•°æ®ç±»å‹ï¼Œè€Œåƒ`bfloat16`è¿™æ ·çš„æ•°æ®ç±»å‹åœ¨æ‰€æœ‰å®ç°ä¸­å¹¶ä¸å®Œå…¨æ”¯æŒã€‚Mojoé€šè¿‡åœ¨æ ‡å‡†åº“ä¸­æä¾›ä¸€ä¸ª`autotune`å‡½æ•°æ¥æä¾›å¸®åŠ©ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³ç¼–å†™ä¸€ä¸ªä¸å‘é‡é•¿åº¦æ— å…³çš„ç®—æ³•æ¥å¤„ç†ä¸€ä¸ªæ•°æ®ç¼“å†²åŒºï¼Œä½ å¯ä»¥è¿™æ ·å†™ï¼š

```auto
from Autotune import autotune

def exp_buffer_impl[dt: DType](data: ArraySlice[dt]):
    # Pick vector length for this dtype and hardware
    alias vector_len = autotune(1, 4, 8, 16, 32)

    # Use it as the vectorization length
    vectorize[exp[dt, vector_len]](data)
```


ç¼–è¯‘æ­¤ä»£ç çš„å®ä¾‹æ—¶ï¼ŒMojoä¼šå¯¹æ­¤ç®—æ³•çš„ç¼–è¯‘è¿›è¡Œåˆ†å‰ï¼Œå¹¶é€šè¿‡è¡¡é‡ç›®æ ‡ç¡¬ä»¶ä¸Šæœ€ä½³å®è·µæ¥å†³å®šä½¿ç”¨å“ªä¸ªã€‚æ ¹æ®ç”¨æˆ·å®šä¹‰çš„æ€§èƒ½è¯„ä¼°å™¨ï¼Œå®ƒè¯„ä¼°`vector_len`è¡¨è¾¾å¼çš„ä¸åŒå€¼ï¼Œå¹¶é€‰æ‹©æœ€å¿«çš„ä¸€ä¸ªã€‚å› ä¸ºå®ƒä¼šå•ç‹¬æµ‹é‡å’Œè¯„ä¼°æ¯ä¸ªé€‰é¡¹ï¼Œæ‰€ä»¥å®ƒå¯èƒ½ä¼šä¸ºFloat32é€‰æ‹©ä¸€ä¸ªä¸åŒäºInt8çš„å‘é‡é•¿åº¦ã€‚è¿™ä¸ªç®€å•çš„åŠŸèƒ½éå¸¸å¼ºå¤§â€”â€”è¶…è¶Šäº†ç®€å•çš„æ•´æ•°å¸¸é‡â€”â€”å› ä¸ºå‡½æ•°å’Œç±»å‹ä¹Ÿæ˜¯å‚æ•°è¡¨è¾¾å¼ã€‚


ä½ å¯ä»¥é€šè¿‡æä¾›æ€§èƒ½è¯„ä¼°å™¨å¹¶ä½¿ç”¨[`search()`](https://docs.modular.com/mojo/MojoStdlib/Autotune.html#search)æ ‡å‡†åº“å‡½æ•°æ¥å¯¹`exp_buffer_impl()`çš„æœç´¢è¿›è¡Œ`search()`å‡½æ•°æ¥å—ä¸€ä¸ªè¯„ä¼°å™¨å’Œä¸€ä¸ªåˆ†å‰å‡½æ•°ï¼Œå¹¶ä»¥å‚æ•°ç»“æœè¿”å›ç”±è¯„ä¼°å™¨é€‰æ‹©çš„æœ€å¿«å®ç°ã€‚

```auto
from Autotune import search

fn exp_buffer[dt: DType](data: ArraySlice[dt]):
    # Forward declare the result parameter.
    alias best_impl: fn(ArraySlice[dt]) -> None

    # Perform search!
    search[
      fn(ArraySlice[dt]) -> None,
      exp_buffer_impl[dt],
      exp_evaluator[dt] -> best_impl
    ]()

    # Call the selected implementation
    best_impl(data)
```


åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°†`exp_evaluator`ä½œä¸ºæ€§èƒ½è¯„ä¼°å™¨æä¾›ç»™æœç´¢å‡½æ•°ã€‚æ€§èƒ½è¯„ä¼°å™¨è¢«è°ƒç”¨æ—¶ä¼ å…¥ä¸€ä¸ªå€™é€‰å‡½æ•°åˆ—è¡¨ï¼Œåº”è¯¥è¿”å›æœ€ä½³å‡½æ•°çš„ç´¢å¼•ã€‚Mojoçš„æ ‡å‡†åº“æä¾›äº†ä¸€ä¸ª`Benchmark`æ¨¡å—ï¼Œå¯ä»¥ç”¨æ¥è®¡æ—¶å‡½æ•°ã€‚

```auto
from Benchmark import Benchmark

fn exp_evaluator[dt: DType](
    fns: Pointer[fn(ArraySlice[dt]) -> None],
    num: Int
):
    var best_idx = -1
    var best_time = -1
    for i in range(num):
        candidate = fns[i]
        let buf = Buffer[dt]()

        # Benchmark this candidate.
        fn setup():
            buf.fill_random()
        fn wrapper():
            candidate(buf)
        let cur_time = Benchmark(2).run[wrapper, setup]()

        # Track the index of the fastest candidate.
        if best_idx < 0:
            best_idx = i
            best_time = cur_time
        elif best_time > cur_time:
            best_idx = f_idx
            best_time = cur_time

    # Return the fastest implementation.
    return best_idx
```

è‡ªåŠ¨è°ƒèŠ‚å…·æœ‰æŒ‡æ•°çº§çš„è¿è¡Œæ—¶å¤æ‚åº¦ã€‚å®ƒå—ç›ŠäºMojoç¼–è¯‘å™¨å †æ ˆçš„å†…éƒ¨å®ç°ç»†èŠ‚ï¼ˆç‰¹åˆ«æ˜¯MLIRï¼Œé›†æˆç¼“å­˜å’Œç¼–è¯‘åˆ†å‘ï¼‰ã€‚è¿™æ˜¯ä¸€ä¸ªé«˜çº§ç”¨æˆ·åŠŸèƒ½ï¼Œéœ€è¦ä¸æ–­çš„å¼€å‘å’Œè¿­ä»£ã€‚

## â€œä»·å€¼ç”Ÿå‘½å‘¨æœŸâ€ï¼šä»·å€¼çš„è¯ç”Ÿã€ç”Ÿæ´»å’Œæ­»äº¡

åœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œæ‚¨åº”è¯¥ç†è§£Mojoå‡½æ•°å’Œç±»å‹çš„æ ¸å¿ƒè¯­ä¹‰å’Œç‰¹æ€§ï¼Œå› æ­¤æˆ‘ä»¬ç°åœ¨å¯ä»¥è®¨è®ºå®ƒä»¬å¦‚ä½•ç»“åˆèµ·æ¥ã€‚

è®¸å¤šç°æœ‰çš„è¯­è¨€éƒ½ä»¥ä¸åŒçš„æƒè¡¡æ¥è¡¨è¾¾è®¾è®¡ç‚¹ï¼šä¾‹å¦‚ï¼ŒC++éå¸¸å¼ºå¤§ï¼Œä½†ç»å¸¸è¢«æŒ‡è´£â€œé»˜è®¤å€¼é”™è¯¯â€ï¼Œè¿™å¯¼è‡´äº†é”™è¯¯å’ŒåŠŸèƒ½ä¸æ­£å¸¸ã€‚Swiftå¾ˆå®¹æ˜“ä½¿ç”¨ï¼Œä½†æ˜¯æ¨¡å‹ä¸å¤ªå¯é¢„æµ‹ï¼Œä¼šç»å¸¸å¤åˆ¶å€¼ï¼Œè€Œä¸”è¿˜ä¾èµ–äºâ€œARCä¼˜åŒ–å™¨â€æ¥æé«˜æ€§èƒ½ã€‚Rustä»ä¸€å¼€å§‹å°±æœ‰å¾ˆå¼ºçš„å€¼æ‰€æœ‰æƒç›®æ ‡æ¥æ»¡è¶³å…¶å€Ÿç”¨æ£€æŸ¥å™¨ï¼Œä½†æ˜¯ä¾èµ–äºå¯ç§»åŠ¨çš„å€¼ï¼Œè¿™ä½¿å¾—è¡¨è¾¾è‡ªå®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°å˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ï¼Œå¹¶ä¸”å¯èƒ½å¯¹`memcpy`æ€§èƒ½é€ æˆå¾ˆå¤§å‹åŠ›ã€‚åœ¨Pythonä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯å¯¹ç±»çš„å¼•ç”¨ï¼Œå› æ­¤å®ƒä»æ¥ä¸ä¼šé‡åˆ°ç±»å‹é—®é¢˜ã€‚


å¯¹äºMojoï¼Œæˆ‘ä»¬ä»è¿™äº›ç°æœ‰çš„ç³»ç»Ÿä¸­å­¦ä¹ åˆ°äº†ä¸œè¥¿ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯æä¾›ä¸€ä¸ªéå¸¸å¼ºå¤§çš„æ¨¡å‹ï¼ŒåŒæ—¶ä»ç„¶æ˜“äºæˆ‘ä»¬ä¹Ÿä¸å¸Œæœ›è¦æ±‚ç¼–è¯‘å™¨æ„å»ºâ€œå°½åŠ›è€Œä¸ºâ€å’Œéš¾ä»¥é¢„æµ‹çš„ä¼˜åŒ–é€šè¿‡â€œè¶³å¤Ÿèªæ˜â€ã€‚

ä¸ºäº†æ¢ç´¢è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸åŒçš„ä»·å€¼åˆ†ç±»å’Œç›¸å…³çš„MojoåŠŸèƒ½ï¼Œä»åº•éƒ¨å¼€å§‹æ„å»ºä¸€ä¸ªå…¨é¢çš„ç³»æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä»¥C++ä½œä¸ºä¸»è¦æ¯”è¾ƒç‚¹ï¼Œå› ä¸ºå®ƒæ˜¯ä¼—æ‰€å‘¨çŸ¥çš„ï¼Œä½†å¦‚æœå…¶ä»–è¯­è¨€æä¾›äº†æ›´å¥½çš„æ¯”è¾ƒç‚¹ï¼Œæˆ‘ä»¬ä¹Ÿä¼šè¿›è¡Œå‚è€ƒã€‚

## ä¸èƒ½å®ä¾‹åŒ–çš„ç±»å‹

Mojoä¸­æœ€åŸºæœ¬çš„ç±»å‹æ˜¯ä¸å…è®¸åˆ›å»ºå®ƒçš„å®ä¾‹çš„ï¼šè¿™äº›ç±»å‹æ ¹æœ¬æ²¡æœ‰åˆå§‹åŒ–å™¨ï¼Œå¦‚æœå®ƒä»¬æœ‰ææ„å‡½æ•°ï¼Œå®ƒå°†æ°¸è¿œä¸ä¼šè¢«è°ƒç”¨ï¼ˆå› ä¸ºæ— æ³•å­˜åœ¨éœ€è¦é”€æ¯çš„å®ä¾‹ï¼‰ï¼š

```auto
struct NoInstances:
    var state: Int  # Pretty useless

    alias my_int = Int

    @staticmethod
    fn print_hello():
        print("hello world")
```


Mojoç±»å‹é»˜è®¤ä¸æä¾›æ„é€ å‡½æ•°ã€ç§»åŠ¨æ„é€ å‡½æ•°ã€æˆå‘˜åˆå§‹åŒ–å™¨æˆ–å…¶ä»–ä»»ä½•å†…å®¹ï¼Œå› æ­¤æ— æ³•åˆ›å»ºæ­¤`NoInstances`ã€‚è¦è·å–å®ƒä»¬ï¼Œä½ éœ€è¦å®šä¹‰ä¸€ä¸ª`__init__`æ–¹æ³•æˆ–ä½¿ç”¨ä¸€ä¸ªåˆæˆåˆå§‹åŒ–å™¨çš„è£…é¥°å™¨ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œè¿™äº›ç±»å‹å¯ä»¥ç”¨ä½œâ€œå‘½åç©ºé—´â€ï¼Œå› ä¸ºå³ä½¿æ— æ³•å®ä¾‹åŒ–è¯¥ç±»å‹çš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥å¼•ç”¨é™æ€æˆå‘˜æ¯”å¦‚`NoInstances.my_int` or `NoInstances.print_hello()`

## ä¸å¯ç§»åŠ¨å’Œä¸å¯å¤åˆ¶çš„ç±»å‹


å¦‚æœæˆ‘ä»¬åœ¨å¤æ‚ç¨‹åº¦ä¸Šè¿ˆå‡ºä¸€æ­¥ï¼Œæˆ‘ä»¬å°†åˆ°è¾¾å¯ä»¥å®ä¾‹åŒ–çš„ç±»å‹ï¼Œä½†ä¸€æ—¦å®ƒä»¬è¢«å›ºå®šåˆ°å†…å­˜ä¸­çš„åœ°å€ï¼Œå°±ä¸èƒ½éšå¼åœ°ç§»åŠ¨æˆ–èµ‹å€¼ã€‚è¿™åœ¨å®ç°åŸå­æ“ä½œç±»å‹ï¼ˆä¾‹å¦‚C++ä¸­çš„`std::atomic`ï¼‰æˆ–å…¶ä»–ç±»å‹æ—¶éå¸¸æœ‰ç”¨ï¼Œå…¶ä¸­å†…å­˜åœ°å€æ˜¯å…¶æ ‡è¯†å¹¶ä¸”å¯¹å…¶ç›®çš„è‡³å…³é‡è¦

```auto
struct Atomic:
    var state: Int

    fn __init__(inout self, state: Int = 0):
        self.state = state

    fn __iadd__(inout self, rhs: Int):
        #...atomic magic...

    fn get_value(self) -> Int:
        return atomic_load_int(self.state)
```


è¿™ä¸ªç±»å®šä¹‰äº†ä¸€ä¸ªåˆå§‹åŒ–å™¨ï¼Œä½†æ²¡æœ‰å¤åˆ¶æˆ–ç§»åŠ¨æ„é€ å‡½æ•°ï¼Œå› æ­¤ä¸€æ—¦å®ƒè¢«åˆå§‹åŒ–ï¼Œå°±æ°¸è¿œä¸èƒ½è¢«ç§»åŠ¨è¿™æ˜¯å®‰å…¨æœ‰ç”¨çš„ï¼Œå› ä¸ºMojoçš„æ‰€æœ‰æƒç³»ç»Ÿå®Œå…¨æ˜¯â€œåœ°å€æ­£ç¡®â€çš„ - å½“è¿™ä¸ªå¯¹è±¡æ˜¯åœ¨æ ˆä¸Šåˆå§‹åŒ–æˆ–ä½œä¸ºå…¶ä»–ç±»å‹çš„å­—æ®µï¼Œå®ƒæ°¸è¿œä¸éœ€è¦ç§»åŠ¨ã€‚

è¯·æ³¨æ„ï¼ŒMojoçš„æ–¹æ³•ä»…æ§åˆ¶å†…ç½®çš„ç§»åŠ¨æ“ä½œï¼Œä¾‹å¦‚`a = b`å¤åˆ¶å’Œ[`^` transfer operator](#owned-arguments)ã€‚ä½ å¯ä»¥ä¸ºè‡ªå·±çš„ç±»å‹ï¼ˆæ¯”å¦‚ä¸Šé¢çš„`Atomic`ï¼‰ä½¿ç”¨ä¸€ç§æœ‰ç”¨çš„æ¨¡å¼ï¼Œå³æ·»åŠ ä¸€ä¸ªæ˜¾å¼çš„`copy()`æ–¹æ³•ï¼ˆéâ€œåŒä¸‹è¿™å¯¹äºç¨‹åºå‘˜çŸ¥é“å®‰å…¨æ—¶æ˜ç¡®å¤åˆ¶å®ä¾‹æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚

## å”¯ä¸€çš„â€œç§»åŠ¨å‹â€ç±»å‹


å¦‚æœæˆ‘ä»¬åœ¨èƒ½åŠ›é˜¶æ¢¯ä¸Šå†è¿ˆå‡ºä¸€æ­¥ï¼Œæˆ‘ä»¬å°†é‡åˆ°â€œå”¯ä¸€â€ç±»å‹ - C++ä¸­æœ‰å¾ˆå¤šç¤ºä¾‹ï¼Œä¾‹å¦‚åƒ`std::unique_ptr`è¿™æ ·çš„ç±»å‹ï¼Œæˆ–è€…æ‹¥æœ‰åº•å±‚POSIXæ–‡ä»¶æè¿°ç¬¦çš„`FileDescriptor`ç±»å‹ã€‚è¿™ç§ç±»å‹åœ¨åƒRustè¿™æ ·çš„è¯­è¨€ä¸­å¾ˆæ™®éï¼Œè¿™äº›è¯­è¨€ä¸é¼“åŠ±å¤åˆ¶ï¼Œä½†â€œç§»åŠ¨â€æ˜¯å…è´¹çš„ã€‚åœ¨Mojoä¸­ï¼Œå¯ä»¥é€šè¿‡å®šä¹‰`__moveinit__`æ–¹æ³•æ¥æ‹¥æœ‰ä¸€ç§ç‹¬ç‰¹çš„ç§»åŠ¨ç±»å‹æ¥å®ç°è¿™äº›ç§»åŠ¨ã€‚ä¾‹å¦‚ï¼š

```auto
# This is a simple wrapper around POSIX-style fcntl.h functions.
struct FileDescriptor:
    var fd: Int

    # This is how we move our unique type.
    fn __moveinit__(inout self, owned existing: Self):
        self.fd = existing.fd

    # This takes ownership of a POSIX file descriptor.
    fn __init__(inout self, fd: Int):
        self.fd = fd

    fn __init__(inout self, path: String):
        # Error handling omitted, call the open(2) syscall.
        self = FileDescriptor(open(path, ...))

    fn __del__(owned self):
        close(self.fd)   # pseudo code, call close(2)

    fn dup(self) -> Self:
        # Invoke the dup(2) system call.
        return Self(dup(self.fd))
    fn read(...): ...
    fn write(...): ...
```


æ¶ˆè´¹æ€§ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆ`__moveinit__`ï¼‰æ‹¥æœ‰ç°æœ‰çš„`FileDescriptor`ï¼Œå¹¶å°†å…¶å†…éƒ¨å®ç°ç»†èŠ‚ç§»åŠ¨åˆ°æ–°å®ä¾‹ã€‚å› ä¸º`FileDescriptor`çš„å®ä¾‹å¯èƒ½å­˜åœ¨ä¸åŒçš„ä½ç½®ï¼Œå®ƒä»¬å¯ä»¥é€»è¾‘ä¸Šç§»åŠ¨â€”â€”å·å–ä¸€ä¸ªå€¼çš„ä¸»ä½“å¹¶ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ã€‚

ä»¥ä¸‹æ˜¯ä¸€ä¸ªæå…¶ç³Ÿç³•çš„ä¾‹å­ï¼Œå®ƒä¼šå¤šæ¬¡è°ƒç”¨`__moveinit__`ï¼š

```auto
fn egregious_moves(owned fd1: FileDescriptor):
    # fd1 and fd2 have different addresses in memory, but the
    # transfer operator moves unique ownership from fd1 to fd2.
    let fd2 = fd1^

    # Do it again, a use of fd2 after this point will produce an error.
    let fd3 = fd2^

    # We can do this all day...
    let fd4 = fd3^
    fd4.read(...)
    # fd4.__del__() runs here
```


æ³¨æ„å¦‚ä½•ä½¿ç”¨åç¼€`^`â€œè½¬ç§»â€æ“ä½œç¬¦åœ¨å„ä¸ªæ‹¥æœ‰å®ƒçš„å€¼ä¹‹é—´è½¬ç§»å€¼çš„æ‰€æœ‰æƒï¼Œè¯¥æ“ä½œç¬¦é”€æ¯å…ˆå‰çš„å¦‚æœä½ ç†Ÿæ‚‰C++ï¼Œå¯ä»¥æŠŠä¼ è¾“æ“ä½œç¬¦æƒ³è±¡æˆ`std::move`ï¼Œä½†åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒèƒ½å¤Ÿç§»åŠ¨äº‹ç‰©è€Œæ— éœ€å°†å®ƒä»¬é‡ç½®ä¸ºå¯è¢«é”€æ¯çš„çŠ¶æ€ï¼šåœ¨C++ä¸­ï¼Œå¦‚æœç§»åŠ¨æ“ä½œç¬¦æœªèƒ½æ›´æ”¹æ—§å€¼çš„`fd`å®ä¾‹ï¼Œå®ƒå°†è¢«å…³é—­ä¸¤æ¬¡ã€‚


Mojoè·Ÿè¸ªå€¼çš„æ´»åŠ›ï¼Œå¹¶å…è®¸æ‚¨å®šä¹‰è‡ªå®šä¹‰ç§»åŠ¨æ„é€ å‡½æ•°ã€‚è¿™å¾ˆå°‘éœ€è¦ï¼Œä½†æ˜¯å½“éœ€è¦çš„æ—¶å€™åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚ä¾‹å¦‚ï¼Œåƒ[`llvm::SmallVector type`](https://llvm.org/docs/ProgrammersManual.html#llvm-adt-smallvector-h)è¿™æ ·çš„ç±»å‹ä½¿ç”¨â€œå†…è”å­˜å‚¨â€ä¼˜åŒ–æŠ€æœ¯ï¼Œå®ƒä»¬å¯èƒ½å¸Œè¿™æ˜¯ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„æŠ€å·§ï¼Œç”¨äºå‡å°‘mallocå†…å­˜åˆ†é…å™¨çš„å‹åŠ›ï¼Œä½†è¿™æ„å‘³ç€â€œç§»åŠ¨â€æ“ä½œéœ€è¦è‡ªå®šä¹‰é€»è¾‘æ¥æ›´æ–°æŒ‡é’ˆ


ä½¿ç”¨Mojoï¼Œè¿™åªéœ€è¦å®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„`__moveinit__`æ–¹æ³•å³å¯ã€‚åœ¨C++ä¸­å®ç°è¿™ä¸€ç‚¹ä¹Ÿå¾ˆå®¹æ˜“ï¼ˆå°½ç®¡åœ¨ä¸éœ€è¦è‡ªå®šä¹‰é€»è¾‘çš„æƒ…å†µä¸‹éœ€è¦é¢å¤–çš„æ ·æ¿ä»£ç ï¼‰ï¼Œä½†åœ¨å…¶ä»–æµè¡Œçš„å†…å­˜å®‰å…¨çš„è¯­è¨€ä¸­å®ç°èµ·æ¥å¾ˆå›°éš¾ã€‚

é™¤æ­¤ä¹‹å¤–ï¼ŒMojoç¼–è¯‘å™¨æä¾›äº†è‰¯å¥½çš„å¯é¢„æµ‹æ€§å’Œæ§åˆ¶èƒ½åŠ›ï¼Œä½†ä¹Ÿéå¸¸å¤æ‚ã€‚å®ƒä¿ç•™äº†æ¶ˆé™¤ä¸´æ—¶å˜é‡åŠç›¸åº”çš„å¤åˆ¶/ç§»åŠ¨æ“ä½œçš„æƒåˆ©ã€‚å¦‚æœè¿™ä¸é€‚åˆæ‚¨çš„ç±»å‹ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨åƒ`copy()`è¿™æ ·çš„æ˜¾å¼æ–¹æ³•è€Œä¸æ˜¯åŒä¸‹åˆ’çº¿æ–¹æ³•ã€‚

## æ”¯æŒâ€œå·è¢­â€çš„ç±»å‹


å†…å­˜å®‰å…¨è¯­è¨€çš„ä¸€ä¸ªæŒ‘æˆ˜æ˜¯ï¼Œå®ƒä»¬éœ€è¦æä¾›ä¸€ä¸ªå¯é¢„æµ‹çš„ç¼–ç¨‹æ¨¡å‹ï¼Œä»¥ä¾¿ç¼–è¯‘å™¨èƒ½å¤Ÿè·Ÿè¸ªï¼Œç¼–ä¾‹å¦‚ï¼Œå°½ç®¡ç¼–è¯‘å™¨å¯ä»¥ç†è§£ä¸‹é¢ç¬¬ä¸€ä¸ªä¾‹å­ä¸­çš„ä¸¤ä¸ªæ•°ç»„è®¿é—®æ˜¯å¯¹ä¸åŒæ•°ç»„å…ƒç´ çš„è®¿é—®ï¼Œï¼Œä½†å¯¹äºç¬¬äºŒä¸ªç¤ºä¾‹æ¥è¯´ï¼Œé€šå¸¸å¾ˆéš¾å¯¹å…¶è¿›è¡Œæ¨ç†ã€‚

```auto
std::pair<T, T> getValues1(MutableArray<T> &array) {
    return { std::move(array[0]), std::move(array[1]) };
}
std::pair<T, T> getValues2(MutableArray<T> &array, size_t i, size_t j) {
    return { std::move(array[i]), std::move(array[j]) };
}
```


è¿™é‡Œçš„é—®é¢˜æ˜¯ï¼Œä»…ä»…ä»ä¸Šé¢çš„å‡½æ•°ä½“æ¥çœ‹ï¼Œæ ¹æœ¬æ— æ³•çŸ¥é“æˆ–è¯æ˜`i`å’Œ`j`çš„åŠ¨æ€å€¼æ˜¯ä¸æ˜¯ç›¸åŒçš„ã€‚å°½ç®¡å¯ä»¥ç»´æŠ¤åŠ¨æ€çŠ¶æ€æ¥è·Ÿè¸ªæ•°ç»„çš„å„ä¸ªå…ƒç´ æ˜¯å¦æ´»åŠ¨ï¼Œä½†è¿™å¾€å¾€ä¼šå¯¼è‡´æ˜¾è‘—çš„è¿è¡Œæ—¶å¼€é”€ï¼ˆå³ä½¿ä¸æœ‰å¤šç§å¤„ç†æ–¹å¼ï¼ŒåŒ…æ‹¬ä¸€äº›ç›¸å½“å¤æ‚çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™äº›æ–¹æ¡ˆå¹¶ä¸æ€»æ˜¯å®¹æ˜“å­¦ä¹ ã€‚


Mojoé‡‡å–åŠ¡å®çš„æ–¹æ³•ï¼Œè®©Mojoç¨‹åºå‘˜å¯ä»¥åœ¨ä¸å¿…ç»•è¿‡å…¶ç±»å‹ç³»ç»Ÿçš„æƒ…å†µä¸‹å®Œæˆä»»åŠ¡ã€‚å¦‚ä¸Šæ‰€ç¤ºï¼Œå®ƒä¸å¼ºåˆ¶ç±»å‹å¯å¤åˆ¶ã€å¯ç§»åŠ¨æˆ–ç”šè‡³å¯æ„é€ ï¼Œä½†å®ƒç¡®å®å¸Œæœ›ç±»å‹èƒ½å¤Ÿè¡¨è¾¾å…¶å®Œæ•´çš„çº¦å®šï¼Œå¹¶ä¸”å¸Œæœ›èƒ½å¤Ÿæ”¯æŒç¨‹åºå‘˜ä»C++ç­‰è¯­è¨€ä¸­æœŸæœ›çš„æµç•…è®¾è®¡æ¨¡å¼ã€‚è¿™é‡Œçš„ï¼ˆä¼—æ‰€å‘¨çŸ¥çš„ï¼‰è§‚å¯Ÿæ˜¯ï¼Œè®¸å¤šå¯¹è±¡å…·æœ‰å¯ä»¥åœ¨ä¸éœ€è¦ç¦ç”¨å…¶ææ„å‡½æ•°çš„æƒ…å†µä¸‹â€œçªƒå–â€ï¼Œè¿™è¦ä¹ˆæ˜¯å› ä¸ºå®ƒä»¬å…·æœ‰â€œç©ºçŠ¶æ€â€ï¼ˆä¾‹å¦‚å¯é€‰ç±»å‹æˆ–å¯ç©ºæŒ‡é’ˆï¼‰ï¼Œè¦ä¹ˆæ˜¯å› ä¸ºå®ƒä»¬å…·æœ‰åˆ›å»ºé«˜æ•ˆä¸”é”€æ¯ä¸éœ€è¦é¢å¤–æ“ä½œçš„ç©ºå€¼ï¼ˆä¾‹å¦‚ï¼Œ`std::vector`å¯ä»¥åœ¨å…¶æ•°æ®éƒ¨åˆ†ä½¿ç”¨ç©ºæŒ‡é’ˆï¼‰ã€‚

ä¸ºäº†æ”¯æŒè¿™äº›ç”¨ä¾‹ï¼Œ[`^` transfer operator](#owned-arguments)æ”¯æŒä»»æ„çš„LValuesï¼Œå½“åº”ç”¨äºä¸€ä¸ªLValueæ—¶ï¼Œå®ƒä¼šè°ƒç”¨â€œstealing move constructorâ€ã€‚è¿™ä¸ªæ„é€ å‡½æ•°å¿…é¡»è®¾ç½®æ–°å€¼ä¸ºæ´»è·ƒçŠ¶æ€ï¼Œå¹¶ä¸”å¯ä»¥ä¿®æ”¹æ—§å€¼ï¼Œä½†å®ƒå¿…é¡»å°†æ—§å€¼ç½®äºå…¶ææ„å‡½æ•°ä»å¯æ­£å¸¸å·¥ä½œçš„çŠ¶æ€ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³å°†æˆ‘ä»¬çš„`FileDescriptor`æ”¾å…¥ä¸€ä¸ªå‘é‡ä¸­å¹¶ç§»å‡ºå®ƒï¼Œæˆ‘ä»¬å¯èƒ½ä¼šé€‰æ‹©æ‰©å±•å®ƒï¼ŒçŸ¥é“`-1`æ˜¯ä¸€ä¸ªå“¨æˆ‘ä»¬å¯ä»¥è¿™æ ·å®ç°ï¼š

```auto
# This is a simple wrapper around POSIX-style fcntl.h functions.
struct FileDescriptor:
    var fd: Int

    # This is the new key capability.
    fn __moveinit__(inout self, inout existing: Self):
        self.fd = existing.fd
        existing.fd = -1  # neutralize 'existing'.

    fn __moveinit__(inout self, owned existing: Self): # as above
    fn __init__(inout self, fd: Int): # as above
    fn __init__(inout self, path: String): # as above

    fn __del__(owned self):
        if self.fd != -1:
            close(self.fd)   # pseudo code, call close(2)
```


æ³¨æ„ï¼Œâ€œå·çªƒç§»åŠ¨â€æ„é€ å‡½æ•°ä»ç°æœ‰å€¼ä¸­è·å–æ–‡ä»¶æè¿°ç¬¦ï¼Œå¹¶ä½¿è¯¥å€¼å‘ç”Ÿå˜åŒ–ï¼Œä»¥ä½¿å…¶ææ„å‡½æ•°ä¸æ‰§ã€‚è¿™ç§æŠ€æœ¯æœ‰æƒè¡¡ä¹‹å¤„ï¼Œå¹¶ä¸æ˜¯æ¯ç§é—®é¢˜çš„æœ€ä½³é€‰æ‹©ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä¸ºææ„å‡½æ•°å¢åŠ äº†ä¸€ä¸ªï¼ˆå»‰ä»·çš„ï¼‰åˆ†æ”¯ï¼Œå› ä¸ºå®ƒå¿…é¡»æ£€æŸ¥å“¨å…µæƒ…å†µã€‚ä¸€èˆ¬è®¤ä¸ºï¼Œä½¿ç”¨è¿™ç§ç±»å‹æ¥å®ç°å¯ç©ºæ€§æ˜¯ä¸å¥½çš„åšæ³•ï¼Œå› ä¸ºæ›´é€šç”¨çš„ç‰¹æ€§ï¼Œæ¯”å¦‚`Optional[T]`ç±»å‹ï¼Œæ˜¯å¤„ç†è¿™äº›æ›´å¥½çš„æ–¹å¼


æ­¤å¤–ï¼Œæˆ‘ä»¬è®¡åˆ’åœ¨Mojoæœ¬èº«ä¸­å®ç°`Optional[T]`ï¼Œè€Œ`Optional`éœ€è¦æ­¤åŠŸèƒ½ã€‚æˆ‘ä»¬ä¹Ÿç›¸ä¿¡ï¼Œåº“ä½œè€…æ¯”è¯­è¨€è®¾è®¡è€…æ›´æ‡‚ä»–ä»¬çš„é¢†åŸŸé—®é¢˜ï¼Œå¹¶ä¸”é€šå¸¸æ›´å€¾å‘äºå°†å¯¹è¯¥é¢†åŸŸçš„å®Œå…¨æ§åˆ¶æƒäº¤ç»™åº“çš„ä½œè€…ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥é€‰æ‹©ï¼ˆä½†ä¸å¿…ï¼‰ä»¥é€‰æ‹©çš„æ–¹å¼ä½¿æ‚¨çš„ç±»å‹å‚ä¸æ­¤è¡Œä¸ºã€‚

## å¯å¤åˆ¶ç±»å‹


ä¸‹ä¸€ä¸ªæ­¥éª¤æ˜¯å¯å¤åˆ¶çš„ç±»å‹ã€‚å¯å¤åˆ¶ç±»å‹ä¹Ÿéå¸¸å¸¸è§ - ç¨‹åºå‘˜é€šå¸¸æœŸæœ›å­—ç¬¦ä¸²å’Œæ•°ç»„å¯ä»¥å¤åˆ¶ï¼Œæ¯ä¸ªPythonå¯¹è±¡å¼•ç”¨éƒ½æ˜¯å¯å¤åˆ¶çš„ - é€šè¿‡èµ‹å€¼æŒ‡é’ˆå¹¶æ›´æ”¹å¼•ç”¨è®¡æ•°ã€‚


æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å®ç°å¯å¤åˆ¶ç±»å‹ã€‚å¯ä»¥åƒPythonæˆ–Javaé‚£æ ·å®ç°å¼•ç”¨è¯­ä¹‰ç±»å‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¯ä»¥ä¼ æ’­å…±äº«æŒ‡é’ˆï¼›å¯ä»¥ä½¿ç”¨ä¸å¯å˜çš„æ•°æ®ç»“è¿™äº›æ–¹æ³•å„æœ‰ä¸åŒçš„æƒè¡¡ï¼ŒMojoè®¤ä¸ºï¼Œè™½ç„¶æˆ‘ä»¬å¸Œæœ›æœ‰ä¸€äº›å¸¸è§çš„é›†åˆç±»å‹ï¼Œä½†æˆ‘ä»¬ä¹Ÿå¯ä»¥æ”¯æŒå¹¿æ³›çš„ä¸“ä¸šåŒ–ç±»å‹ï¼Œä¸“æ³¨äºç‰¹å®šçš„ç”¨ä¾‹ã€‚


åœ¨Mojoä¸­ï¼Œä½ å¯ä»¥é€šè¿‡å®ç°`__copyinit__`æ–¹æ³•æ¥å®ç°è¿™ä¸€ç‚¹ã€‚ä»¥ä¸‹æ˜¯ä½¿ç”¨ç®€å•`String`åœ¨ä¼ªä»£ç ä¸­çš„ä¸€ä¸ªç¤ºä¾‹ï¼š

```auto
struct MyString:
    var data: Pointer[UI8]

    # StringRef is a pointer + length and works with StringLiteral.
    def __init__(inout self, input: StringRef):
        self.data = ...

    # Copy the string by deep copying the underlying malloc'd data.
    def __copyinit__(inout self, existing: Self):
        self.data = strdup(existing.data)

    # This isn't required, but optimizes unneeded copies.
    def __moveinit__(inout self, owned existing: Self):
        self.data = existing.data

    def __del__(owned self):
        free(self.data.address)

    def __add__(self, rhs: MyString) -> MyString: ...
```


è¿™ç§ç®€å•çš„ç±»å‹æ˜¯ä¸€ä¸ªæŒ‡å‘ä½¿ç”¨æ—§å¼C APIé€šè¿‡mallocåˆ†é…çš„â€œä»¥nullç»“å°¾â€å­—ç¬¦ä¸²æ•°æ®çš„æŒ‡é’ˆã€‚å®ƒå®ç°äº†`__copyinit__`ï¼Œå®ƒç»´æŠ¤äº†æ¯ä¸ª`MyString`å®ä¾‹éƒ½æ‹¥æœ‰å…¶åº•å±‚æŒ‡é’ˆå¹¶åœ¨é”€æ¯æ—¶é‡Šæ”¾å®ƒçš„ä¸å˜æ€§ã€‚è¿™ç§å®ç°å»ºç«‹åœ¨æˆ‘ä»¬ä¸Šé¢çœ‹åˆ°çš„æŠ€å·§ä¹‹ä¸Šï¼Œå®ç°äº†ä¸€ä¸ª`__moveinit__`æ„é€ å‡½æ•°ï¼Œå®ƒå…è®¸å®ƒåœ¨ä¸€äº›å¸¸è§æƒ…å†µä¸‹å®Œå…¨ä½ å¯ä»¥åœ¨è¿™ä¸ªä»£ç åºåˆ—ä¸­çœ‹åˆ°è¿™ç§è¡Œä¸ºï¼š

```auto
fn test_my_string():
    var s1 = MyString("hello ")

    var s2 = s1    # s2.__copyinit__(s1) runs here

    print(s1)

    var s3 = s1^   # s3.__moveinit__(s1) runs here

    print(s2)
    # s2.__del__() runs here
    print(s3)
    # s3.__del__() runs here
```


åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥çœ‹åˆ°ä¸ºä»€ä¹ˆéœ€è¦æ‹·è´æ„é€ å‡½æ•°ï¼šå¦‚æœæ²¡æœ‰å®ƒï¼Œå°†`s1`å€¼å¤åˆ¶åˆ°`s2`å°†æ˜¯ä¸€ä¸ªé”™è¯¯â€”â€”å› ä¸ºæ‚¨ä¸èƒ½åŒæ—¶æ‹¥æœ‰ä¸¤ä¸ªåŒä¸€éå¯å¤åˆ¶ç±»å‹çš„æ´»åŠ¨å®ä¾‹ã€‚ç§»åŠ¨æ„é€ å‡½æ•°æ˜¯å¯é€‰çš„ï¼Œä½†æœ‰åŠ©äºå°†`s3`èµ‹å€¼ï¼šå¦‚æœæ²¡æœ‰å®ƒï¼Œç¼–è¯‘å™¨å°†ä»s1è°ƒç”¨æ‹·è´è¿™åœ¨é€»è¾‘ä¸Šæ˜¯æ­£ç¡®çš„ï¼Œä½†ä¼šå¢åŠ é¢å¤–çš„è¿è¡Œæ—¶å¼€é”€ã€‚

Mojoçƒ­åˆ‡åœ°ç ´åä»·å€¼ï¼Œè¿™ä½¿å¾—å®ƒèƒ½å¤Ÿå°†å¤åˆ¶+é”€æ¯å¯¹è½¬æ¢ä¸ºå•æ­¥æ“ä½œï¼Œè¿™å¯ä»¥æ¯”C++å¸¦æ¥æ›´å¥½çš„æ€§èƒ½ï¼Œè€Œä¸éœ€è¦æ™®éçš„ `std::move` çš„å¾®è§‚ç®¡ç†

## è½»æ¾ç±»å‹

æœ€çµæ´»çš„ç±»å‹å°±æ˜¯â€œbags of bitsâ€ã€‚è¿™äº›ç±»å‹æ˜¯â€œæ— å…³ç´§è¦â€çš„ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨ä¸è°ƒç”¨è‡ªå®šä¹‰ä»£ç çš„æƒ…å†µä¸‹å¤åˆ¶ã€ç§»åŠ¨å’Œé”€æ¯ã€‚è¿™ç±»ç±»å‹å¯ä»¥è¯´æ˜¯æœ€å¸¸è§çš„åŸºæœ¬ç±»å‹ï¼Œå®ƒä»¬åŒ…å›´ç€æˆ‘ä»¬ï¼šåƒæ•´æ•°å’Œæµ®ç‚¹å€¼ç­‰éƒ½æ˜¯å¾®ä¸è¶³é“çš„ä¾‹å­ã€‚ä»è¯­è¨€çš„è§’åº¦æ¥çœ‹ï¼ŒMojoä¸éœ€è¦ç‰¹æ®Šçš„æ”¯æŒï¼Œç±»å‹ä½œè€…å¯ä»¥å°†è¿™äº›ä¸œè¥¿å®ç°ä¸ºç©ºæ“ä½œï¼Œå¹¶å…è®¸å†…è”å‡½æ•°å°†å®ƒä»¬æ¶ˆé™¤æ‰ã€‚


è¿™ç§æ–¹æ³•ä¸å¤ªç†æƒ³æœ‰ä¸¤ä¸ªåŸå› ï¼šç¬¬ä¸€ä¸ªåŸå› æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›åœ¨ç®€å•ç±»å‹ä¸Šå®šä¹‰ä¸€å †æ–¹æ³•æ—¶å‡ºç°æ ·æ¿ä»£ç ï¼Œç¬¬äºŒä¸ªåŸå› æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›åœ¨ç¼–è¯‘æ—¶äº§ç”Ÿå¹¶æ¨åŠ¨ä¸€å †å‡½æ•°è°ƒç”¨å¸¦æ¥çš„å¼€é”€ï¼Œç„¶åè¿™äº›å‡½æ•°è°ƒç”¨æœ€ç»ˆè¢«å†…è”æ‰è€Œå˜æˆæ— æ•ˆã€‚æ­¤å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªç›¸å…³çš„é—®é¢˜ï¼Œå³è®¸å¤šè¿™äº›ç±»å‹åœ¨å¦ä¸€æ–¹é¢ä¹Ÿæ˜¯ç®€å•çš„ï¼šå®ƒä»¬å¾ˆå°ï¼Œå¹¶ä¸”åº”è¯¥åœ¨ CPU çš„å¯„å­˜å™¨ä¸­ç›´æ¥ä¼ é€’ï¼Œè€Œä¸æ˜¯é—´æ¥åœ°é€šè¿‡å†…å­˜ä¼ é€’ã€‚


å› æ­¤ï¼ŒMojoæä¾›äº†ä¸€ä¸ªç»“æ„è£…é¥°å™¨ï¼Œå¯ä»¥è§£å†³æ‰€æœ‰è¿™äº›é—®é¢˜ã€‚ä½¿ç”¨`@register_passable("trivial")`è£…é¥°å™¨å¯ä»¥å®ç°ä¸€ç§ç±»å‹ï¼Œè¿™å‘Šè¯‰Mojoè¯¥ç±»å‹åº”è¯¥æ˜¯å¯å¤åˆ¶å’Œå¯ç§»åŠ¨çš„ï¼Œä½†æ²¡æœ‰ç”¨æˆ·å®ƒè¿˜å‘Šè¯‰Mojoä¼˜å…ˆå°†å€¼ä¼ é€’åˆ°CPUå¯„å­˜å™¨ä¸­ï¼Œè¿™å¯èƒ½ä¼šå¸¦æ¥æ•ˆç‡çš„æå‡ã€‚

TODOï¼šè¿™ä¸ªè£…é¥°å™¨éœ€è¦é‡æ–°è€ƒè™‘ã€‚ç¼ºä¹è‡ªå®šä¹‰é€»è¾‘çš„å¤åˆ¶/ç§»åŠ¨/é”€æ¯é€»è¾‘å’Œâ€œåœ¨å¯„å­˜å™¨ä¸­ä¼ é€’â€çš„å¯è¡Œæ€§æ˜¯å®Œå…¨ä¸ç›¸å…³çš„é—®é¢˜ï¼Œåº”è¯¥åˆ†å¼€è®¨è®ºã€‚è¿™ä¸ªå‰é¢çš„é€»è¾‘åº”è¯¥è¢«åŒ…å«åœ¨ä¸€ä¸ªæ›´åŠ é€šç”¨çš„`@value("trivial")`è£…é¥°å™¨ä¸­ï¼Œå®ƒä¸`@register_passable`æ˜¯ç›¸å…³çš„ã€‚

## @valueè£…é¥°å™¨


Mojoçš„æ–¹æ³•ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰æä¾›äº†ç®€å•è€Œå¯é¢„æµ‹çš„é’©å­ï¼Œä½¿æ‚¨èƒ½å¤Ÿæ­£ç¡®è¡¨è¾¾åƒ`Atomic`è¿™æ ·çš„å¤æ‚ä½çº§åˆ«ä¸œè¥¿ã€‚è¿™å¯¹äºæ§åˆ¶å’Œç®€å•çš„ç¼–ç¨‹æ¨¡å‹æ¥è¯´å¾ˆæ£’ï¼Œä½†æ˜¯æˆ‘ä»¬ç¼–å†™çš„å¤§å¤šæ•°structséƒ½æ˜¯å…¶ä»–ç±»å‹çš„ç®€å•èšåˆï¼Œæˆ‘ä»¬ä¸æƒ³ä¸ºå®ƒä»¬ç¼–å†™å¤§é‡çš„æ ·æ¿ä»£ç ï¼ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMojoæä¾›äº†ä¸€ä¸ª`@value`è£…é¥°å™¨ï¼Œç”¨äºåˆæˆç»“æ„ä½“çš„æ ·æ¿ä»£ç ã€‚`@value` å¯ä»¥çœ‹ä½œæ˜¯ Python çš„ `@dataclass` çš„å»¶ä¼¸ï¼Œå¤„ç†æ–°çš„ `__moveinit__` å’Œ `__copyinit__` Mojo æ–¹æ³•ã€‚


`@value` è£…é¥°å™¨ä¼šæŸ¥çœ‹ä½ ç±»å‹çš„å­—æ®µï¼Œå¹¶ç”Ÿæˆç¼ºå¤±çš„æˆå‘˜ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªç®€å•çš„ç»“æ„ï¼š

```auto
@value
struct MyPet:
    var name: String
    var age: Int
```

Mojoä¼šæ³¨æ„åˆ°æ‚¨æ²¡æœ‰æˆå‘˜åˆå§‹åŒ–å™¨ã€ç§»åŠ¨æ„é€ å‡½æ•°æˆ–å¤åˆ¶æ„é€ å‡½æ•°ï¼Œå¹¶ä¼šæŒ‰ç…§æ‚¨å†™çš„æ–¹å¼ä¸ºæ‚¨åˆæˆè¿™äº›ï¼š

```auto
fn __init__(inout self, owned name: String, age: Int):
    self.name = name^
    self.age = age

fn __copyinit__(inout self, existing: Self):
    self.name = existing.name
    self.age = existing.age

fn __moveinit__(inout self, owned existing: Self):
    self.name = existing.name^
    self.age = existing.age
```

Mojoåªæœ‰åœ¨ä¸å­˜åœ¨æ—¶æ‰ä¼šåˆæˆè¿™äº›å†…å®¹ï¼Œå› æ­¤å¯ä»¥é€šè¿‡ä¸ºå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªå®šä¹‰è‡ªå·±çš„ç‰ˆæœ¬æ¥è¦†ç›–å…¶è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œå¸Œæœ›ä½¿ç”¨é»˜è®¤çš„æˆå‘˜å’Œç§»åŠ¨æ„é€ å‡½æ•°ï¼Œä½†åˆéœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ï¼Œè¿™æ˜¯ç›¸å½“å¸¸è§çš„ã€‚

**æ³¨æ„ï¼š**å¦‚æœæ‚¨çš„ç±»å‹åŒ…å«ä»»ä½•[move-only](#unique-move-only-types)å­—æ®µï¼ŒMojoå°†ä¸ä¼šç”Ÿæˆæ‹·è´æ„é€ å‡½æ•°ï¼Œå› ä¸ºå®ƒæ— æ³•æ‹·è´è¿™äº›å­—æ®µã€‚æ­¤å¤–ï¼Œ`@value` è£…é¥°å™¨ä»…é€‚ç”¨äºå…¶æˆå‘˜å¯å¤åˆ¶å’Œ/æˆ–ç§»åŠ¨çš„ç±»å‹ã€‚å¦‚æœä½ çš„ç»“æ„ä½“ä¸­æœ‰åƒ`Atomic`è¿™æ ·çš„ä¸œè¥¿ï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå€¼ç±»å‹ï¼Œä½ ä¹Ÿä¸æƒ³è¦è¿™äº›æˆå‘˜ã€‚

ç›®å‰æ²¡æœ‰åŠæ³•æŠ‘åˆ¶ç‰¹å®šæ–¹æ³•çš„ç”Ÿæˆæˆ–å®šåˆ¶ç”Ÿæˆï¼Œä½†å¦‚æœæœ‰éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥å‘`@value`ç”Ÿæˆå™¨æ·»åŠ å‚æ•°æ¥å®ç°ã€‚

`__init__`çš„å‚æ•°éƒ½ä½œä¸º`owned`å‚æ•°ä¼ é€’ï¼Œå› ä¸ºç»“æ„ä½“æ‹¥æœ‰å¹¶å­˜å‚¨è¯¥å€¼ã€‚è¿™æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„å¾®è°ƒä¼˜åŒ–ï¼Œå¯ä»¥ä½¿ç”¨åªèƒ½ç§»åŠ¨çš„ç±»å‹ã€‚ç®€å•çš„ç±»å‹ï¼Œæ¯”å¦‚`Int`ï¼Œä¹Ÿä¼šä½œä¸ºæ‹¥æœ‰å€¼ä¼ é€’ï¼Œä½†æ˜¯ç”±äºè¿™å¯¹å®ƒä»¬æ²¡æœ‰ä»»ä½•æ„ä¹‰ï¼Œä¸ºäº†æ¸…æ™°èµ·è§ï¼Œæˆ‘ä»¬çœç•¥äº†æ ‡è®°å’Œè½¬ç§»æ“ä½œç¬¦(`^`)ã€‚

## ææ„å‡½æ•°çš„è¡Œä¸º

åœ¨Mojoä¸­ï¼Œä»»ä½•ç»“æ„ä½“éƒ½å¯ä»¥æœ‰ä¸€ä¸ªææ„å‡½æ•°ï¼ˆ`__del__()`æ–¹æ³•ï¼‰ï¼Œå½“å€¼çš„ç”Ÿå‘½å‘¨æœŸç»“æŸæ—¶ï¼ˆé€šå¸¸æ˜¯å€¼æœ€åè¢«ä½¿ç”¨çš„æ—¶åˆ»ï¼‰ï¼Œè¯¥ææ„å‡½æ•°ä¼šè‡ªåŠ¨è¿è¡Œã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²å¯èƒ½çœ‹èµ·æ¥åƒè¿™æ ·ï¼ˆä¼ªä»£ç ï¼‰ï¼š

```auto
@value
struct MyString:
    var data: Pointer[UInt8]

    def __init__(inout self, input: StringRef): ...
    def __add__(self, rhs: MyString) -> MyString: ...
    def __del__(owned self):
        free(self.data.address)
```


Mojoä½¿ç”¨â€œAs Soon As Possibleâ€ï¼ˆASAPï¼‰ç­–ç•¥ï¼Œåœ¨æ¯æ¬¡è°ƒç”¨åç«‹å³é”€æ¯åƒ`MyString`è¿™æ ·çš„å€¼ï¼ˆé€šè¿‡è°ƒç”¨`__del__()`ææ„å‡½æ•°ï¼‰ã€‚Mojoä¸ä¼šç­‰åˆ°ä»£ç å—ç»“æŸæ—¶æ‰é”€æ¯æœªä½¿ç”¨çš„å€¼ã€‚å³ä½¿åœ¨åƒ`a+b+c+d`è¿™æ ·çš„è¡¨è¾¾å¼ä¸­ï¼ŒMojoä¹Ÿä¼šç«‹å³é”€æ¯ä¸­é—´è¡¨è¾¾å¼ï¼Œåªè¦å®ƒä»¬ä¸å†è¢«éœ€è¦äº†ï¼Œå®ƒä¸ä¼šç­‰åˆ°è¯­å¥ç»“æŸæ‰è¿è¡Œã€‚


Mojoç¼–è¯‘å™¨åœ¨å€¼æ­»äº¡æ—¶è‡ªåŠ¨è°ƒç”¨ææ„å‡½æ•°ï¼Œå¹¶ä¸”åœ¨ä½•æ—¶è¿è¡Œææ„å‡½æ•°æ–¹é¢æä¾›å¼ºæœ‰åŠ›çš„ä¿è¯ã€‚Mojoä½¿ç”¨é™æ€ç¼–è¯‘å™¨åˆ†ææ¥æ¨æ–­ä½ çš„ä»£ç ï¼Œå¹¶å†³å®šä½•æ—¶æ’å…¥ææ„å‡½æ•°çš„è°ƒç”¨ã€‚ä¾‹å¦‚ï¼š

```auto
fn use_strings():
    var a = MyString("hello a")
    var b = MyString("hello b")
    print(a)
    # a.__del__() runs here for "hello a"


    print(b)
    # b.__del__() runs here

    a = MyString("temporary a")
    # a.__del__() runs here because "temporary a" is never used

    other_stuff()

    a = MyString("final a")
    print(a)
    # a.__del__() runs again here for "final a"
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œä½ ä¼šçœ‹åˆ°`a`å’Œ`b`å€¼åœ¨æ—©æœŸå°±å·²ç»åˆ›å»ºï¼Œæ¯ä¸€ä¸ªå€¼çš„åˆå§‹åŒ–éƒ½ä¼šä¸ä¸€ä¸ªææ„å‡½æ³¨æ„`a`è¢«å¤šæ¬¡é”€æ¯â€”â€”æ¯æ¬¡æ¥æ”¶åˆ°æ–°å€¼æ—¶éƒ½ä¼šå‘ç”Ÿä¸€æ¬¡ã€‚


è¿™å¯èƒ½ä¼šè®©C++ç¨‹åºå‘˜æ„Ÿåˆ°æƒŠè®¶ï¼Œå› ä¸ºå®ƒä¸C++åœ¨ä½œç”¨åŸŸç»“æŸæ—¶é”€æ¯å€¼çš„[RAIIæ¨¡å¼](https://en.cppreference.com/w/cpp/language/raii)ä¸åŒã€‚Mojoä¹Ÿéµå¾ªä¸€ä¸ªåŸåˆ™ï¼Œå³åœ¨æ„é€ å‡½æ•°ä¸­è·å–èµ„æºï¼Œåœ¨ææ„å‡½æ•°ä¸­é‡Šæ”¾èµ„æºï¼Œä½†æ˜¯ï¼Œåœ¨Mojoä¸­ï¼ŒåŠæ—¶é”€æ¯ï¼ˆeager destructionï¼‰ç›¸æ¯”äºC++ä¸­åŸºäºä½œç”¨åŸŸçš„é”€æ¯ï¼ˆscope-based destructionï¼‰æœ‰ä¸€äº›æ˜æ˜¾çš„ä¼˜åŠ¿ï¼š

+ Mojoæ–¹æ³•æ¶ˆé™¤äº†ç±»å‹å®ç°é‡æ–°èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå¦‚C++ä¸­çš„`operator =ï¼ˆconst T&ï¼‰`å’Œ`operator =ï¼ˆT&&ï¼‰`ï¼‰çš„éœ€è¦ï¼Œä½¿ç±»å‹å®šä¹‰æ›´åŠ å®¹æ˜“ï¼Œå¹¶ä¸”æ¶ˆé™¤äº†ä¸€ç§æ¦‚å¿µã€‚

+ Mojoä¸å…è®¸å¯å˜å¼•ç”¨ä¸å…¶ä»–å¯å˜å¼•ç”¨æˆ–ä¸å¯å˜å€Ÿç”¨é‡å ã€‚å®ƒæä¾›å¯é¢„æµ‹çš„ç¼–ç¨‹æ¨¡å‹çš„ä¸€ä¸ªä¸»è¦æ–¹å¼æ˜¯å°½å¿«ä½¿å¯¹è±¡çš„å¼•ç”¨æ¶ˆå¤±ï¼Œé¿å…ç¼–è¯‘å™¨è®¤ä¸ºä¸€ä¸ªå€¼ä»ç„¶å­˜æ´»å¹¶å¹²æ‰°å¦ä¸€ä¸ªå€¼çš„æ··ä¹±æƒ…å†µï¼Œè€Œç”¨æˆ·å¯¹æ­¤å¹¶ä¸æ¸…æ¥šã€‚

+ åœ¨æœ€åä½¿ç”¨æ—¶é”€æ¯å€¼ä¸â€œç§»åŠ¨â€ä¼˜åŒ–éå¸¸åŒ¹é…ï¼Œå®ƒå°†â€œå¤åˆ¶+åˆ é™¤â€æ“ä½œè½¬æ¢ä¸ºâ€œç§»åŠ¨â€æ“ä½œï¼Œè¿™æ˜¯å¯¹C++ç§»åŠ¨ä¼˜åŒ–ï¼ˆå¦‚NRVOï¼‰çš„ä¸€ç§æ¨å¹¿ã€‚

+ åœ¨C++ä¸­ï¼Œåœ¨ä½œç”¨åŸŸç»“æŸæ—¶é”€æ¯å€¼å¯èƒ½ä¼šå¯¹ä¸€äº›å¸¸è§çš„æ¨¡å¼ï¼ˆå¦‚å°¾é€’å½’ï¼‰é€ æˆé—®é¢˜ï¼Œå› ä¸ºææ„å‡½æ•°çš„è¿™å¯¹äºæŸäº›å‡½æ•°å¼ç¼–ç¨‹æ¨¡å¼æ¥è¯´å¯èƒ½æ˜¯ä¸€ä¸ªé‡å¤§çš„æ€§èƒ½å’Œå†…å­˜é—®é¢˜ã€‚


é‡è¦çš„æ˜¯ï¼ŒMojoçš„åŠæ—¶é”€æ¯åœ¨Pythoné£æ ¼çš„`def`å‡½æ•°ä¸­ä¹Ÿå¯ä»¥å¾ˆå¥½åœ°å·¥ä½œï¼Œä»¥æä¾›ç»†ç²’åº¦çš„é”€æ¯ä¿è¯ï¼ˆæ— éœ€åƒåœ¾å›æ”¶å™¨ï¼‰ã€‚è¯·æ³¨æ„ï¼ŒPythonå®é™…ä¸Šå¹¶æ²¡æœ‰æä¾›å‡½æ•°ä»¥å¤–çš„ä½œç”¨åŸŸï¼Œå› æ­¤åœ¨Mojoä¸­ä½¿ç”¨ç±»ä¼¼C++çš„ä½œç”¨åŸŸé”€æ¯ä¼šå˜å¾—ä¸é‚£ä¹ˆæœ‰ç”¨ã€‚

**æ³¨æ„ï¼š**Mojoè¿˜æ”¯æŒPythoné£æ ¼çš„[`with`è¯­å¥](https://docs.python.org/3/reference/compound_stmts.html#the-with-statement)ï¼Œå®ƒæä¾›äº†æ›´åŠ æœ‰æ„ä¹‰çš„èŒƒå›´è®¿é—®


Mojoæ–¹æ³•æ›´ç±»ä¼¼äºRustå’ŒSwiftçš„å·¥ä½œæ–¹å¼ï¼Œå› ä¸ºå®ƒä»¬éƒ½å…·æœ‰å¼ºå¤§çš„å€¼æ‰€æœ‰æƒè·Ÿè¸ªåŠŸèƒ½ï¼Œå¹¶æä¾›å†…å­˜å®‰å…¨æ€§ã€‚ä¸€ä¸ªåŒºåˆ«æ˜¯å®ƒä»¬çš„å®ç°éœ€è¦ä½¿ç”¨[åŠ¨æ€â€œdrop flagâ€](https://doc.rust-lang.org/nomicon/drop-flags.html)â€”â€”å®ƒä»¬ç»´æŠ¤éšè—çš„shadowå˜é‡æ¥è·Ÿè¸ªå€¼çš„çŠ¶æ€ä»¥æä¾›å®‰å…¨æ€§ã€‚è¿™äº›é€šå¸¸ä¼šè¢«ä¼˜åŒ–æ‰ï¼Œä½†æ˜¯Mojoæ–¹æ³•å®Œå…¨æ¶ˆé™¤äº†è¿™ç§å¼€é”€ï¼Œä½¿ç”Ÿæˆçš„ä»£ç æ›´å¿«ï¼Œé¿å…äº†æ­§ä¹‰ã€‚

## å­—æ®µæ•æ„Ÿçš„ç”Ÿå‘½å‘¨æœŸç®¡ç†

æ­¤å¤–ï¼ŒMojoçš„ç»ˆèº«åˆ†æå®Œå…¨å…¼å®¹æ§åˆ¶æµï¼Œå®ƒä¹Ÿå®Œå…¨è€ƒè™‘å­—æ®µæ•æ„Ÿæ€§ï¼ˆæ¯ä¸ªç»“æ„çš„å­—æ®µéƒ½æ˜¯ç‹¬ç«‹è·Ÿè¸ªçš„æ¢å¥è¯è¯´ï¼ŒMojoå•ç‹¬è·Ÿè¸ªâ€œæ•´ä¸ªå¯¹è±¡â€æ˜¯å¦å®Œå…¨åˆå§‹åŒ–/é”€æ¯ã€‚

ä¾‹å¦‚ï¼Œåœ¨ä¸Šé¢å®šä¹‰çš„`MyString`ç»“æ„ä½“çš„åŸºç¡€ä¸Šï¼Œè€ƒè™‘ä»¥ä¸‹ä»£ç ï¼š

```auto
struct TwoStrings:
    var str1: MyString
    var str2: MyString
    fn __init__(inout self): ...
    fn __del__(owned self): ...

fn use_two_strings():
    var ts = TwoStrings()
    # ts.str1.__del__() runs here

    other_stuff()

    ts.str1 = MyString("hello a")     # Overwrite ts.str1
    print(ts.str1)
    # ts.__del__() runs here
```


æ³¨æ„ï¼Œ`ts.str1`å­—æ®µåœ¨è¢«è®¾ç½®åç«‹å³è¢«é”€æ¯ï¼Œå› ä¸ºMojoçŸ¥é“å®ƒå°†åœ¨ä¸‹é¢è¢«è¦†ç›–ã€‚æ‚¨ä¹Ÿå¯ä»¥åœ¨ä½¿ç”¨[[transfer operator](#owned-arguments)æ—¶çœ‹åˆ°æ­¤å†…å®¹ï¼Œä¾‹å¦‚ï¼š

```auto
fn consume_and_use_two_strings():
    var ts = TwoStrings()
    consume(ts.str1^)
    # ts.str1.__moveinit__() runs here

    # ts is now only partially initialized here!
    other_stuff()

    ts.str1 = MyString()  # All together now
    use(ts)               # This is ok
    # ts.__del__() runs here
```

æ³¨æ„ï¼Œä»£ç è½¬ç§»äº†`str1`å­—æ®µçš„æ‰€æœ‰æƒï¼šåœ¨`other_stuffï¼ˆï¼‰`çš„æŒç»­æ—¶é—´å†…ï¼Œ`str1`å­—æ®µå®Œå…¨æœªåˆå§‹åŒ–ï¼Œå› ä¸ºæ‰€ç„¶åï¼Œåœ¨`use()`å‡½æ•°ä½¿ç”¨`str1`ä¹‹å‰ï¼Œå®ƒä¼šè¢«é‡æ–°åˆå§‹åŒ–ï¼ˆå¦‚æœä¸è¿™æ ·åšï¼ŒMojo å°†ä¼šæ‹’ç»ä»£ç å¹¶æ˜¾ç¤ºæœªåˆå§‹åŒ–å­—æ®µçš„é”™è¯¯ï¼‰


Mojoå¯¹æ­¤çš„è§„åˆ™éå¸¸å¼ºå¤§è€Œä¸”æœ‰æ„è¯†åœ°ç®€å•æ˜äº†ï¼šå­—æ®µå¯ä»¥è¢«æš‚æ—¶è½¬ç§»ï¼Œä½†æ˜¯"æ•´ä¸ªå¯¹è±¡"å¿…é¡»ä½¿ç”¨èšåˆç±»å‹çš„åˆå§‹åŒ–å™¨è¿›è¡Œæ„é€ ï¼Œå¹¶ä½¿ç”¨èšåˆææ„å‡½æ•°è¿›è¡Œé”€æ¯ã€‚è¿™æ„å‘³ç€æ— æ³•ä»…é€šè¿‡åˆå§‹åŒ–å…¶å­—æ®µæ¥åˆ›å»ºå¯¹è±¡ï¼Œä¹Ÿæ— æ³•ä»…é€šè¿‡é”€æ¯å…¶å­—æ®µæ¥æ‹†é™¤å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œè¿™æ®µä»£ç æ— æ³•ç¼–è¯‘ï¼š

```auto
fn consume_and_use_two_strings():
    var ts = TwoStrings() # ts is initialized
    consume(ts.str1^)
    consume(ts.str2^) # Both members are transferred/destroyed
    # Error: cannot run the 'ts' destructor without initialized fields

    var ts2 : TwoStrings # ts2 type is declared but not initialized
    ts2.str1 = MyString()
    ts2.str2 = MyString()  # Both the member are initalized
    use(ts2) # Error: 'ts2' isn't fully initialized
```


æˆ‘ä»¬å¯ä»¥å…è®¸è¿™ç§æ¨¡å¼å‘ç”Ÿï¼Œä½†æˆ‘ä»¬æ‹’ç»è¿™ç§åšæ³•ï¼Œå› ä¸ºä¸€ä¸ªä»·å€¼ä¸ä»…ä»…æ˜¯å®ƒçš„ç»„æˆéƒ¨åˆ†çš„æ€»å’Œã€‚è€ƒè™‘ä¸€ä¸ªåŒ…å«POSIXæ–‡ä»¶æè¿°ç¬¦ä½œä¸ºæ•´æ•°å€¼çš„`FileDescriptor`ï¼šé”€æ¯æ•´æ•°ï¼ˆæ— æ“ä½œï¼‰å’Œé”€æ¯`FileDescriptor`ï¼ˆå¯èƒ½è°ƒç”¨`close()`ç³»ç»Ÿè°ƒç”¨ï¼‰ã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦æ±‚æ‰€æœ‰å…¨å€¼åˆå§‹åŒ–éƒ½å¿…é¡»é€šè¿‡åˆå§‹åŒ–ç¨‹åºå®Œæˆï¼Œå¹¶ä½¿ç”¨å®ƒä»¬çš„å…¨å€¼ææ„å‡½æ•°è¿›è¡Œé”€æ¯ã€‚

Mojoå†…éƒ¨ç¡®å®æœ‰ä¸€ä¸ªä¸Rustçš„[`mem::forget`](https://doc.rust-lang.org/std/mem/fn.forget.html)å‡½æ•°ç­‰æ•ˆçš„åŠŸèƒ½ï¼Œå®ƒæ˜ç¡®ç¦ç”¨äº†ææ„å‡½æ•°ï¼Œå¹¶å…·æœ‰ç›¸åº”çš„å†…éƒ¨åŠŸèƒ½æ¥â€œæ ‡è®°â€ä¸€ä¸ªå¯¹è±¡ï¼Œä½†ç›®å‰å°šæœªå…¬å¼€ä¾›ç”¨æˆ·ä½¿ç”¨ã€‚è¿™æ„å‘³ç€ç”¨æˆ·æ— æ³•ç›´æ¥ä½¿ç”¨è¿™äº›åŠŸèƒ½ï¼Œè€Œæ˜¯ç”±Mojoå†…éƒ¨ä½¿ç”¨ã€‚

## `__init__`ä¸­çš„å­—æ®µç”Ÿå‘½å‘¨æœŸ


`__init__`æ–¹æ³•çš„è¡Œä¸ºå‡ ä¹å’Œå…¶ä»–æ–¹æ³•ä¸€æ ·ï¼Œåªæ˜¯æœ‰ä¸€ç‚¹å°çš„é­”æ³•ï¼šå®ƒçŸ¥é“å¯¹è±¡çš„å­—æ®µæ˜¯æœªåˆå§‹åŒ–çš„ï¼Œä½†å®ƒè®¤ä¸ºæ•´ä¸ªå¯¹è¿™æ„å‘³ç€ä¸€æ—¦æ‰€æœ‰å­—æ®µéƒ½åˆå§‹åŒ–å®Œæˆï¼Œä½ å°±å¯ä»¥å°†`self`ä½œä¸ºä¸€ä¸ªæ•´ä½“å¯¹è±¡ä½¿ç”¨ã€‚

```auto
struct TwoStrings:
    var str1: MyString
    var str2: MyString

    fn __init__(inout self, cond: Bool, other: MyString):
        self.str1 = MyString()
        if cond:
            self.str2 = other
            use(self)  # Safe to use immediately!
            # self.str2.__del__(): destroyed because overwritten below.

        self.str2 = self.str1
        use(self)  # Safe to use immediately!
```

åŒæ ·ï¼ŒMojoä¸­çš„åˆå§‹åŒ–ç¨‹åºå®Œå…¨è¦†ç›–`self`æ˜¯å®‰å…¨çš„ï¼Œä¾‹å¦‚é€šè¿‡å§”æ‰˜ç»™å…¶ä»–åˆå§‹åŒ–ç¨‹åºï¼š

```auto
struct TwoStrings:
    var str1: MyString
    var str2: MyString

    fn __init__(inout self): ...
    fn __init__(inout self, cond: Bool, other: MyString):
        self = TwoStrings()  # basic
        self.str1 = MyString("fancy")
```

## `__del__`å’Œ`__moveinit__`ä¸­`owned`å‚æ•°çš„å­—æ®µç”Ÿå‘½å‘¨æœŸ


å¯¹äºç§»åŠ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„`owned`å‚æ•°ï¼Œå­˜åœ¨ä¸€ç‚¹æœ€ç»ˆçš„é­”æ³•ã€‚æ€»ç»“ä¸€ä¸‹ï¼Œè¿™äº›æ–¹æ³•æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

```auto
struct TwoStrings:
    var str1: MyString
    var str2: MyString
    fn __init__(...)

    fn __moveinit__(inout self, owned existing: Self): ...
    fn __del__(owned self): ...
```

è¿™äº›æ–¹æ³•é¢ä¸´ä¸€ä¸ªæœ‰è¶£ä½†åˆæ™¦æ¶©éš¾æ‡‚çš„é—®é¢˜ï¼šè¿™ä¸¤ç§æ–¹æ³•éƒ½è´Ÿè´£æ‹†è§£`owned` `existing`/`self`å€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ`__moveinit__()` é”€æ¯ `existing` çš„å­å…ƒç´ ä»¥å°†æ‰€æœ‰æƒè½¬ç§»åˆ°æ–°å®ä¾‹ï¼Œè€Œ `__del__()` åˆ™å®ç°äº†å…¶ `self` å®ä¾‹çš„åˆ å› æ­¤ï¼Œä»–ä»¬éƒ½æƒ³æ‹¥æœ‰å’Œè½¬æ¢`owned`å€¼çš„å…ƒç´ ï¼Œä»–ä»¬è‚¯å®šä¸å¸Œæœ›`owned`å€¼çš„ææ„å‡½æ•°è¿è¡Œï¼ˆåœ¨`__del__()`æ–¹æ³•çš„æƒ…å†µï¼Œé‚£å°†å¯¼è‡´ä¸€ä¸ªæ— é™å¾ªç¯ï¼‰ã€‚


è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒMojoç‰¹åˆ«å¤„ç†è¿™ä¸¤ç§æ–¹æ³•ï¼Œå‡è®¾åœ¨ä»»ä½•ä»æ–¹æ³•è¿”å›æ—¶ï¼Œå®ƒä»¬çš„æ•´ä¸ªå€¼éƒ½è¢«ç ´åäº†ã€‚è¿™æ„å‘³ç€åœ¨å­—æ®µå€¼è¢«ä¼ è¾“ä¹‹å‰ï¼Œæ•´ä¸ªå¯¹è±¡å¯ä»¥è¢«ä½¿ç”¨ã€‚ä¾‹å¦‚ï¼Œè¿™ä¸ªå°±åƒä½ æœŸæœ›çš„é‚£æ ·å·¥ä½œï¼š

```auto
struct TwoStrings:
    var str1: MyString
    var str2: MyString
    fn __init__(...)
    fn __moveinit__(inout self, owned existing: Self): ...

    fn __del__(owned self):
        log(self)       # Self is still whole
        # self.str2.__del__(): Mojo destroys str2 since it isn't used

        consume(self.str1^)
        # Everything has now been transferred, no destructor is run on self.
```


ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä½ ä¸éœ€è¦è€ƒè™‘è¿™ä¸ªï¼Œä½†å¦‚æœä½ çš„é€»è¾‘ä¸­æœ‰æŒ‡å‘æˆå‘˜çš„å†…éƒ¨æŒ‡é’ˆï¼Œä½ å¯èƒ½éœ€è¦åœ¨ææ„å‡½æ•°é€šè¿‡å°†`_`èµ‹å€¼ä¸ºâ€œdiscardâ€æ¨¡å¼å¯ä»¥å®ç°è¿™ä¸€ç‚¹ï¼š

```auto
fn __del__(owned self):
    log(self) # Self is still whole

    consume(self.str1^)
    _ = self.str2
    # self.str2.__del__(): Mojo destroys str2 after its last use.
```

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœ`consume()`éšå¼åœ°æŒ‡å‘`str2`ä¸­çš„æŸä¸ªå€¼ï¼Œè¿™å°†ç¡®ä¿`str2`åœ¨æœ€åä¸€æ¬¡ä½¿ç”¨æ—¶ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡`_`ä¸¢å¼ƒæ¨¡å¼è®¿é—®æ—¶ï¼Œ`str2`ä¸ä¼šè¢«é”€æ¯ã€‚

## ç”Ÿå‘½æœŸ

TODOï¼šè§£é‡Šè¿”å›å¼•ç”¨çš„å·¥ä½œåŸç†ï¼Œä¸å‚æ•°ç›¸å…³çš„ç”Ÿå‘½å‘¨æœŸå¦‚ä½•åè°ƒä¸€è‡´ã€‚è¿™è¿˜æ²¡æœ‰å¯ç”¨ã€‚

## ç±»å‹ç‰¹å¾


è¿™æ˜¯ä¸€ä¸ªéå¸¸ç±»ä¼¼äºRustç‰¹æ€§æˆ–Swiftåè®®æˆ–Haskellç±»å‹ç±»çš„åŠŸèƒ½ã€‚æ³¨æ„ï¼Œè¿™è¿˜æ²¡æœ‰å®ç°ã€‚

## é«˜çº§/éšè”½çš„MojoåŠŸèƒ½


æœ¬èŠ‚æè¿°äº†é‡è¦çš„é«˜çº§ç”¨æˆ·åŠŸèƒ½ï¼Œç”¨äºæ„å»ºæ ‡å‡†åº“çš„æœ€åº•å±‚ã€‚è¿™ä¸€å±‚å †æ ˆä¸­å±…ä½ç€éœ€è¦ç»éªŒä¸°å¯Œçš„ç¼–è¯‘å™¨å†…éƒ¨çŸ¥è¯†æ‰èƒ½ç†è§£å’Œæœ‰æ•ˆåˆ©ç”¨çš„ç‹­çª„ç‰¹æ€§ã€‚

## @register_passable struct è£…é¥°å™¨

é»˜è®¤çš„å¤„ç†å€¼çš„æ¨¡å‹æ˜¯å®ƒä»¬å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤å®ƒä»¬å…·æœ‰æ ‡è¯†ï¼Œè¿™æ„å‘³ç€å®ƒä»¬é—´æ¥åœ°ä¼ é€’ç»™å‡½æ•°å¹¶ä»å‡½æ•°ã€‚è¿™å¯¹äºæ— æ³•ç§»åŠ¨çš„ç±»å‹éå¸¸æœ‰ç”¨ï¼Œå¯¹äºå¤§å‹å¯¹è±¡æˆ–å…·æœ‰æ˜‚è´µçš„å¤åˆ¶æ“ä½œçš„äº‹ç‰©æ¥è¯´æ˜¯ä¸€ä¸ªå®‰å…¨çš„é»˜è®¤å€¼ã€‚ç„¶è€Œï¼Œå¯¹äºåƒå•ä¸ªæ•´æ•°æˆ–æµ®ç‚¹æ•°è¿™æ ·çš„å°ä¸œè¥¿æ¥è¯´ï¼Œå®ƒæ˜¯ä½æ•ˆçš„ã€‚


é€šè¿‡ä½¿ç”¨ `@register_passable` è£…é¥°å™¨ï¼ŒMojoå…è®¸ç»“æ„ä½“é€‰æ‹©é€šè¿‡å¯„å­˜å™¨è€Œä¸æ˜¯é€šè¿‡å†…å­˜ä¼ é€’æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚æ‚¨å°†åœ¨æ ‡å‡†åº“ä¸­çš„`Int`ç±»å‹ä¸Šçœ‹åˆ°è¿™ä¸ªè£…é¥°å™¨ï¼š

```auto
@register_passable("trivial")
struct Int:
    var value: __mlir_type.`!pop.scalar<index>`

    fn __init__(value: __mlir_type.`!pop.scalar<index>`) -> Self:
        return Self {value: value}
    ...
```


åŸºæœ¬çš„`@register_passable`è£…é¥°å™¨ä¸ä¼šæ”¹å˜ç±»å‹çš„åŸºæœ¬è¡Œä¸ºï¼šå®ƒä»ç„¶éœ€è¦æœ‰ä¸€ä¸ª`__copyinit__`æ–¹æ³•æ‰èƒ½è¢«å¤åˆ¶ï¼Œå¯èƒ½ä»ç„¶æœ‰`è¿™ä¸ªè£…é¥°å™¨çš„ä¸»è¦å½±å“æ˜¯åœ¨å†…éƒ¨å®ç°ç»†èŠ‚ä¸Šï¼š`@register_passable`ç±»å‹é€šå¸¸ä¼šè¢«ä¼ é€’åˆ°æœºå™¨å¯„å­˜å™¨ï¼ˆå–å†³äºåº•å±‚æ¶æ„çš„å…·ä½“ç»†èŠ‚ã€‚ï¼‰

å¯¹äºå…¸å‹çš„Mojoç¨‹åºå‘˜æ¥è¯´ï¼Œè¿™ä¸ªè£…é¥°å™¨åªæœ‰å‡ ä¸ªå¯è§‚å¯Ÿçš„æ•ˆæœï¼š

1. `@register_passable` ç±»å‹ä¸èƒ½ä¿å­˜ä¸æ˜¯ `@register_passable` ç±»å‹çš„å®ä¾‹ã€‚
1. `@register_passable`ç±»å‹çš„å®ä¾‹æ²¡æœ‰å¯é¢„æµ‹çš„èº«ä»½ï¼Œå› æ­¤`self`æŒ‡é’ˆæ˜¯ä¸ç¨³å®š/å¯é¢„æµ‹çš„ï¼ˆä¾‹å¦‚ï¼Œæ¯æ¬¡åœ¨å“ˆå¸Œè¡¨ä¸­ï¼‰ã€‚
1. `@register_passable` å‚æ•°å’Œç»“æœå¯ä»¥ç›´æ¥è¢« C å’Œ C++ è®¿é—®ï¼Œè€Œä¸æ˜¯é€šè¿‡æŒ‡é’ˆä¼ é€’ã€‚
1. è¿™ç§ç±»å‹çš„`__init__`å’Œ`__copyinit__`æ–¹æ³•éšå¼åœ°æ˜¯é™æ€çš„ï¼ˆå°±åƒPythonä¸­çš„`__new__`ä¸€æ ·ï¼‰ï¼Œå¹¶ä¸”ä»¥å€¼çš„å½¢å¼è¿”å›ç»“æœè€Œä¸æ˜¯é‡‡ç”¨`inout self`


æˆ‘ä»¬é¢„è®¡è¿™ä¸ªè£…é¥°å™¨å°†è¢«å¹¿æ³›åº”ç”¨äºæ ¸å¿ƒæ ‡å‡†åº“ç±»å‹ï¼Œä½†å¯¹äºä¸€èˆ¬åº”ç”¨ç¨‹åºçº§ä»£ç å¯ä»¥å®‰å…¨å¿½ç•¥ã€‚


ä¸Šé¢çš„`Int`ç¤ºä¾‹å®é™…ä¸Šä½¿ç”¨äº†è¿™ä¸ªè£…é¥°å™¨çš„â€œtrivialâ€å˜ä½“ã€‚å®ƒæ”¹å˜äº†ä¸Šè¿°æè¿°çš„ä¼ é€’çº¦å®šï¼Œä½†ä¹Ÿç¦æ­¢äº†æ‹·è´å’Œç§»åŠ¨æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼ˆå°†å®ƒä»¬åˆæˆä¸ºå¹³å‡¡å‡½æ•°ã€‚)

TODOï¼šç”±äºå®ƒä¹Ÿé€‚ç”¨äºå†…å­˜ç±»å‹ï¼Œå› æ­¤Trivialéœ€è¦è¢«è§£è€¦åˆ°å…¶è‡ªå·±çš„è£…é¥°å™¨ä¸­ã€‚

## `@always_inline`è£…é¥°å™¨

`@always_inline("nodebug")`ï¼šåŒæ ·çš„äº‹æƒ…ï¼Œä½†æ²¡æœ‰è°ƒè¯•ä¿¡æ¯ï¼Œå› æ­¤æ‚¨ä¸ä¼šè¿›å…¥Intä¸Šçš„+æ–¹æ³•ã€‚

## `@parameter` è£…é¥°å™¨

`@parameter` è£…é¥°å™¨å¯ä»¥æ”¾ç½®åœ¨æ•è·è¿è¡Œæ—¶å€¼çš„åµŒå¥—å‡½æ•°ä¸Šï¼Œä»¥åˆ›å»ºâ€œå‚æ•°åŒ–â€æ•è·é—­åŒ…ã€‚variables.è¿™æ˜¯Mojoä¸­ä¸€ä¸ªä¸å®‰å…¨çš„ç‰¹æ€§ï¼Œå› ä¸ºæˆ‘ä»¬ç›®å‰æ²¡æœ‰æ¨¡æ‹Ÿå¼•ç”¨æ•è·å˜é‡çš„ç”Ÿå‘½å‘¨æœŸã€‚è¿™ä¸ªç‰¹æ€§çš„ä¸€ä¸ªç‰¹æ®Šæ–¹é¢æ˜¯å®ƒå…è®¸å°†æ•è·è¿è¡Œæ—¶å€¼çš„é—­åŒ…ä½œä¸ºå‚æ•°å€¼ä¼ é€’ã€‚

## é­”æœ¯è¿ç®—ç¬¦


C++ä»£ç æœ‰è®¸å¤šç¥å¥‡çš„æ“ä½œç¬¦ï¼Œå®ƒä»¬ä¸å€¼ç”Ÿå‘½å‘¨æœŸç›¸äº¤ï¼Œæ¯”å¦‚â€œplacement newâ€ã€â€œplacement deleteâ€å’Œâ€œoperator=â€ï¼Œå®ƒä»¬å¯ä»¥é‡æ–°åˆ†é…ç»™ä¸€ä¸ªç°æœ‰å€¼ã€‚Mojoåœ¨ä½¿ç”¨å…¶æ‰€æœ‰è¯­è¨€ç‰¹æ€§å¹¶åœ¨å®‰å…¨æ„é€ ç‰©ä¸Šç»„åˆæ—¶æ˜¯ä¸€ç§å®‰å…¨çš„è¯­è¨€ï¼Œä¸è¿‡ï¼Œå¦‚æœä½¿ç”¨å †æ ˆï¼Œå°±æ¶‰åŠåˆ°Cé£æ ¼æŒ‡é’ˆå’Œæ™®éå­˜åœ¨çš„ä¸å®‰å…¨æ€§ã€‚Mojoæ˜¯ä¸€ç§åŠ¡å®çš„è¯­è¨€ï¼Œç”±äºæˆ‘ä»¬å¯¹ä¸C/C++äº’æ“ä½œä»¥åŠåœ¨Mojoæœ¬èº«å®ç°å®‰å…¨æ„é€ ï¼ˆå¦‚Stringï¼‰éƒ½å¾ˆæ„Ÿå…´è¶£ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ç§è¡¨è¾¾ä¸å®‰å…¨æ“ä½œçš„æ–¹å¼ã€‚


Mojoæ ‡å‡†åº“`Pointer[element_type]`ç±»å‹åœ¨MLIRä¸­ç”¨`!pop.pointer<element_type>`ç±»å‹å®ç°ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨Mojoä¸­å®ç°è¿™äº›ä¸C++ç­‰æ•ˆçš„ä¸å®‰å…¨ç»“æ„ã€‚æœ€ç»ˆï¼Œè¿™äº›å°†è¿ç§»åˆ°æŒ‡é’ˆç±»å‹çš„æ‰€æœ‰æ–¹æ³•ä¸Šï¼Œä½†åœ¨æ­¤ä¹‹å‰ï¼Œä¸€äº›éœ€è¦ä½œä¸ºå†…ç½®æ“ä½œç¬¦å…¬å¼€ã€‚

## ç›´æ¥è®¿é—®MLIR


Mojoæä¾›å¯¹MLIRæ–¹è¨€å’Œç”Ÿæ€ç³»ç»Ÿçš„å®Œå…¨è®¿é—®æƒé™ã€‚è¯·æŸ¥çœ‹[Mojoä¸­çš„ä½çº§IR](https://docs.modular.com/mojo/notebooks/BoolMLIR.html)ï¼Œå­¦ä¹ å¦‚ä½•ä½¿ç”¨`__mlir_type`ã€`__mlir_op`å’Œ`__mlir_type`æ„é€ ã€‚Mojoé€šè¿‡è°ƒç”¨åº•å±‚MLIRæ„é€ å®ç°æ‰€æœ‰å†…ç½®å’Œæ ‡å‡†åº“APIï¼Œè¿™æ ·åšï¼ŒMojoå®é™…ä¸Šç›¸å½“äºMLIRçš„è¯­æ³•ç³–ã€‚

